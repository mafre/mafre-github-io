"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{36882:function(t,s,i){i.r(s),i.d(s,{default:function(){return sn}});var e=i(85893),h=i(67294),a=i(41166),n={windowWidth:0,windowHeight:0,height:0,width:0,scale:8,mouseX:0,mouseY:0,mouseDown:!1},d=i(38167),o=i.n(d),l={fps:60,entityCount:0,worldStep:30};class r{constructor(t,s){this.messageType=t,this.callback=s}}class c{constructor(){var t=this;this.subscribe=(t,s)=>{let i=new r(t,s);return this.subscriptions.push(i),i},this.unsubscribe=(t,s)=>{let i=this.subscriptions.find(i=>i.messageType===t&&i.callback===s);i&&this.remove(i)},this.remove=t=>{let s=this.subscriptions.indexOf(t);this.subscriptions.splice(s,1)},this.clear=t=>{let s=this.subscriptions.filter(s=>s.messageType===t);for(let t in s)this.remove(t)},this.dispatch=function(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let e of t.subscriptions.filter(t=>t.messageType===s))e.callback(i)},this.subscriptions=[]}}let p=new c;var g={SET_STATE:"setState",ADD_ENTITY:"addEntity",REMOVE_ENTITY:"removeEntity",REMOVE_TYPE:"removeType",SET_SCALE:"setScale",SET_FPS:"setFPS",SHOW_LAYER:"showLayer",HIDE_LAYER:"hideLayer",SHOW_OVERLAY:"showOverlay",HIDE_OVERLAY:"hideOverlay",KEY_DOWN:"keyDown",KEY_UP:"keyUp",ENABLE_KEYS:"enableKeys",DISABLE_KEYS:"disableKeys",COLLISION:"collision",CREATE_BODY:"createBody",DESTROY_BODY:"destroyBody",PAUSE_APP:"pauseApp",RESUME_APP:"resumeApp"};class m{constructor(t){this.pause=()=>{this.paused=!0},this.resume=()=>{this.paused=!1},this.onSetFPS=()=>{this.stop(),this.delay=Math.round(1e3/l.fps),this.start()},this.addEntity=t=>{this.entities.push(t),0===t.id&&(t.id=l.entityCount),this.entities.push(t),t.view&&this.view.add(t),t.init(),l.entityCount++},this.removeEntity=t=>{if(!this.entities.find(s=>s===t))return;t.dispose();let s=this.entities.indexOf(t);this.entities.splice(s,1),t.view&&this.view.remove(t),l.entityCount-=1},this.removeType=t=>{this.entities.filter(s=>s.type===t).forEach(t=>{this.removeEntity(t)})},this.onCollision=t=>{let s=this.findById(t.uA.id),i=this.findById(t.uB.id);s&&i&&(s.handleCollision(i),i.handleCollision(s))},this.findById=t=>this.entities.find(s=>s.id===t),this.start=()=>{this.interval=setInterval(()=>{this.counter+=1,this.update(this.counter)},this.delay)},this.stop=()=>{clearInterval(this.interval)},this.update=t=>{!this.paused&&(this.view.clear(),this.entities.forEach(s=>{s.update(t),!s.remove&&s.render&&this.view.render(s)}),this.entities.forEach(t=>{t.remove&&this.remove.push(t)}),this.remove.length>0&&(this.remove.forEach(t=>{this.removeEntity(t)}),this.remove=[]))},this.view=t,this.entities=[],this.remove=[],this.delay=Math.round(1e3/l.fps),this.counter=0,this.entityCount=0,this.paused=!1,p.subscribe(g.PAUSE_APP,this.pause),p.subscribe(g.RESUME_APP,this.resume),p.subscribe(g.SET_FPS,this.onSetFPS),p.subscribe(g.ADD_ENTITY,this.addEntity),p.subscribe(g.REMOVE_ENTITY,this.removeEntity),p.subscribe(g.REMOVE_TYPE,this.removeType),p.subscribe(g.COLLISION,this.onCollision)}}var y=i(73875),u={DEFAULT:"default",WALL:"wall",PLAYER:"player",PARTICLE:"particle",ENEMY:"enemy",SUICA:"suica"};let w={};var x={down:t=>{w[t]=!0},up:t=>{w[t]=!1},key:t=>w[t]},b={addEntity:t=>{p.dispatch(g.ADD_ENTITY,t)},removeEntity:t=>{p.dispatch(g.REMOVE_ENTITY,t)},removeType:t=>{p.dispatch(g.REMOVE_TYPE,t)},setState:t=>{p.dispatch(g.SET_STATE,t)},setScale:t=>{n.scale=t,n.width=n.windowWidth/n.scale,n.height=n.windowHeight/n.scale,p.dispatch(g.SET_SCALE,t)},setFPS:t=>{l.fps=t,p.dispatch(g.SET_FPS,t)},setLayerVisibility:(t,s)=>{s?p.dispatch(g.SHOW_LAYER,t):p.dispatch(g.HIDE_LAYER,t)},showOverlay:t=>{p.dispatch(g.SHOW_OVERLAY,t)},hideOverlay:()=>{p.dispatch(g.HIDE_OVERLAY)},keyDown:t=>{x.down(t),p.dispatch(g.KEY_DOWN,t)},keyUp:t=>{x.up(t),p.dispatch(g.KEY_UP,t)},enableKeys:t=>{p.dispatch(g.ENABLE_KEYS,t)},disableKeys:()=>{p.dispatch(g.DISABLE_KEYS)},createBody:(t,s,i,e)=>{p.dispatch(g.CREATE_BODY,{entity:t,shape:s,bodyDef:i,fixDef:e})},destroyBody:t=>{p.dispatch(g.DESTROY_BODY,t)}};class v extends o(){constructor(){super(),this.init=()=>{},this.mouseDown=t=>{this.onMouseDownCallback=t},this.update=()=>{},this.addBody=t=>{this.body=t;let s=y.Vec2(this.x,this.y);this.body.setPosition(s)},this.removeBody=()=>{this.body&&b.destroyBody(this.body)},this.pos=()=>({x:this.x,y:this.y}),this.handleCollision=()=>{},this.dispose=()=>{},this.id=0,this.layer=0,this.type=u.DEFAULT,this.view=!1,this.render=!1,this.remove=!1,this.addEventListener(MouseEvent.MOUSE_DOWN,()=>{this.onMouseDownCallback&&this.onMouseDownCallback(this)})}}var E=v;class T extends E{getBodyAtMouse(){this.mousePVec=new y.B2Vec2(this.stage.mouseX,this.stage.mouseY);let t=new y.AABB;t.lowerBound.Set(this.mousePVec.x-.001,this.mousePVec.y-.001),t.upperBound.Set(this.mousePVec.x+.001,this.mousePVec.y+.001),this.world.queryAABB(this.getBodyCB,t)}getBodyCB(t){return!(t.GetBody().GetType()!==y.B2Body.b2_staticBody&&t.GetShape().TestPoint(t.GetBody().GetTransform(),this.mousePVec))}constructor(){super(),this.createBody=t=>{let{entity:s,shape:i,bodyDef:e,fixDef:h}=t,a=this.world.createBody(e);a.createFixture(i,h),a.setMassData({mass:10,center:(0,y.Vec2)(0,0),I:1}),s.addBody(a)},this.destroyBody=t=>{this.world.destroyBody(t)},this.update=()=>{this.world.step(1/l.worldStep)},this.world=y.World({gravity:new y.Vec2(0,50),continuousPhysics:!0}),this.world.on("post-solve",t=>{let s=t.getFixtureA(),i=s.getBody(),e=s.getUserData(),h=t.getFixtureB(),a=h.getBody(),n=h.getUserData();p.dispatch(g.COLLISION,{uA:e,uB:n,bA:i,bB:a})}),p.subscribe(g.CREATE_BODY,this.createBody),p.subscribe(g.DESTROY_BODY,this.destroyBody)}}var D=i(15137),f=i.n(D);class S extends E{constructor(t=null,s=null,i=null){var e;super(),e=this,this.onMouseMove=t=>{this.setMousePos(t.stageX,t.stageY)},this.onMouseDown=t=>{this.setMousePos(t.stageX,t.stageY),this.mouseDown=!0},this.onMouseUp=t=>{this.mouseDown=!1},this.onMouseLeave=t=>{this.mouseDown=!1},this.setMousePos=(t,s)=>{this.xMouse=t/n.scale,this.yMouse=s/n.scale},this.setBackground=t=>{this.background.addChild(t)},this.add=t=>{this.content.addChild(t),this.items.push(t),this.autoCenter&&this.centerContent()},this.fill=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.width,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.height;e.background.graphics.beginFill(t),e.background.graphics.drawRect(0,0,s,i),e.background.graphics.endFill()},this.sort=()=>{for(let t of this.items.sort((t,s)=>t.y>s.y?1:t.y<s.y?-1:0))this.content.addChild(t)},this.center=()=>{this.x=n.width/2-this.width/2,this.y=n.height/2-this.height/2},this.centerBackground=()=>{this.background.x=n.width/2-this.background.width/2,this.background.y=n.height/2-this.background.height/2},this.centerContent=()=>{this.content.x=n.width/2-this.content.width/2,this.content.y=n.height/2-this.content.height/2},this.removeAll=()=>{for(let t of this.items)b.removeEntity(t),this.content.removeChild(t);this.items=[]},this.dispose=()=>{this.removeAll()},this.xMouse=0,this.yMouse=0,this.mouseDown=!1,this.items=[],this.view=!0,this.autoCenter=!1,this.background=new(o()),this.content=new(o()),this.addChild(this.background),this.addChild(this.content),this.addEventListener(f().MOUSE_MOVE,this.onMouseMove),this.addEventListener(f().MOUSE_DOWN,s=>{this.onMouseDown(s),t&&t(s)}),this.addEventListener(f().MOUSE_UP,this.onMouseUp),this.addEventListener(f().MOUSE_LEAVE,this.onMouseLeave)}}class B extends E{constructor(t,s=0,i=0){super(),this.getArgb=(t,s)=>0+(s<<24)+t,this.draw=()=>{let t;t=16777215+(2.55*(parseInt((this.bitmap.getPixel(this.x,this.y)>>24&255).toString(16))+3)<<24),this.bitmap.setPixel(this.x,this.y,t)},this.update=t=>{let s=3*Math.random();s<1?this.x-=1:s>2&&(this.x+=1),this.x<0&&(this.x=0),this.x>this.bitmap.width&&(this.x=this.bitmap.width);let i=3*Math.random();i<1?this.y-=1:i>2&&(this.y+=1),this.y<0&&(this.y=0),this.y>this.bitmap.height&&(this.y=this.bitmap.height),this.draw()},this.bitmap=t,this.x=s,this.y=i}}class L{constructor(t,s){this.update=()=>{this.time+=1,this.time%this.delay==0&&this.callback()},this.delay=t,this.callback=s,this.time=Math.floor(100*Math.random())}}let C={HORIZONTAL:"horizontal",VERTICAL:"vertical"};class M extends o(){constructor(){super(),this.add=t=>{this.items.push(t),this.addChild(t),this.align()},this.horizontal=()=>{this.alignment=C.HORIZONTAL},this.vertical=()=>{this.alignment=C.VERTICAL},this.align=()=>{if(this.alignment===C.HORIZONTAL){let t=0;this.items.forEach(s=>{s.x=t,t+=s.width+this.spacing})}else if(this.alignment===C.VERTICAL){let t=0;this.items.forEach(s=>{s.y=t,t+=s.height+this.spacing})}},this.setWidth=t=>{this.items.forEach(s=>{s.setWidth(t)})},this.next=()=>{this.deselect(),this.selectedIndex+=1,this.selectedIndex>=this.items.length&&(this.selectedIndex=0),this.select(this.selectedIndex)},this.previous=()=>{this.deselect(),this.selectedIndex-=1,this.selectedIndex<0&&(this.selectedIndex=this.items.length-1),this.select(this.selectedIndex)},this.deselect=()=>{this.selected&&(this.selected.hideHighlight(),this.selected=null)},this.select=t=>{this.selectedIndex=t,this.selected=this.items[t],this.selected.showHighlight()},this.items=[],this.alignment=C.HORIZONTAL,this.spacing=0,this.selected=null,this.selectedIndex=-1}}var O=i(88117),A=i.n(O),F=i(34691),k=i(19349),P=i(21926),_=i.n(P),I={F:"04b03",ATTRACT:"Attract"};class N extends o(){constructor(t,s=I.F,i=10,e=16777215){super(),this.setText=t=>{this.text=t,this.textField.text=t},this.setFont=t=>{this.font=t,this.update()},this.setSize=t=>{this.size=t,this.update()},this.update=()=>{this.textField.defaultTextFormat=new(_())(this.font,this.size,this.color),this.textField.text=this.text},this.text=t,this.font=s,this.size=i,this.color=e;let h=new(_())(s,i,e);this.textField=new(A()),this.textField.defaultTextFormat=h,this.textField.embedFonts=!0,this.textField.selectable=!1,this.textField.antiAliasType=F.ZP.ADVANCED,this.textField.autoSize=k.ZP.LEFT,this.textField.text=t,this.addChild(this.textField)}}class Y extends o(){constructor(){super();let t=new(_())(I.F,30,16777215);this.textField=new(A()),this.textField.defaultTextFormat=t,this.textField.embedFonts=!0,this.textField.selectable=!0,this.textField.antiAliasType=F.ZP.ADVANCED,this.addChild(this.textField)}}var R=i(56018),W=i.n(R),U=i(95727),K=i.n(U);class V extends o(){constructor(t){if(super(),this.center=()=>{this.bitmap.x=-this.bitmap.width/2,this.bitmap.y=-this.bitmap.height/2},!t)return;this.bitmapData=W().getBitmapData("assets/".concat(t)),this.bitmap=new(K())(this.bitmapData),this.bitmap.smoothing=!1,this.addChild(this.bitmap)}}var H=i(39073),X=i.n(H),z=i(44680),G=i.n(z),q=i(8060);class Z extends o(){constructor(t,s,i,e=10){super(),this.setIndexX=t=>{this.indexX=t,this.render()},this.setIndexY=t=>{this.indexY=t,this.render()},this.render=()=>{let t=new(X())(1,0,0,1,-this.w*this.indexX,-this.h*this.indexY);this.bmd1.fillRect(this.bmd1.rect,0),this.bmd1.draw(this.bmd,t)},this.play=()=>{this.playing=!0,this.interval=setInterval(()=>{this.indexY+=1,this.indexY===this.framesY&&(this.indexY=0),this.render()},this.delay)},this.stepX=()=>{this.indexX+=1,this.indexX===this.framesX&&(this.indexX=0),this.render()},this.playX=()=>{this.playing=!0,this.interval=setInterval(this.stepX,this.delay)},this.stop=()=>{this.playing=!1,this.indexY=1,this.indexX=1,this.render(),this.interval&&clearInterval(this.interval)},this.delay=e,this.bmd=W().getBitmapData("assets/".concat(t)),this.framesX=s,this.framesY=i,this.indexX=0,this.indexY=0,this.playing=!1,this.w=Math.round(this.bmd.width/this.framesX),this.h=Math.round(this.bmd.height/this.framesY),this.bmd1=new(G())(this.w,this.h,!0,0),this.bm=new(K())(this.bmd1,q.ZP.AUTO,!1),this.addChild(this.bm),this.render()}}var j=i(47660),J=i.n(j);class Q extends o(){constructor(t,s){var i;super(),i=this,this.data=()=>this.bmd,this.draw=t=>{this.bmd.draw(t,new(X())(1,0,0,1,t.x,t.y))},this.getPixel=(t,s)=>this.bmd.getPixel32(t,s),this.setPixel=function(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215;i.bmd.setPixel32(t,s,e)},this.rect=(t,s,i,e,h)=>{let a=new(J())(t,s,i,e);this.bmd.fillRect(a,h)},this.clear=()=>{this.bmd.fillRect(new(J())(0,0,this.bm.width,this.bm.height),0)},this.bmd=new(G())(t,s,!0,0),this.bm=new(K())(this.bmd,q.ZP.NEVER,!1),this.addChild(this.bm)}}var $=i(33292),tt=i.n($);let ts=Math.sqrt(5),ti=(ts+1)/2,te=2/3*45,th=(t,s)=>Math.atan2(s.y-t.y,s.x-t.x),ta=(t,s)=>({x:t*te+s*te,y:s*te/2-t*te/2}),tn=t=>th({x:t.x*n.scale,y:t.y*n.scale},{x:n.mouseX,y:n.mouseY});var td={fib:t=>(Math.pow(ti,t)-Math.pow(-1,t))/ts,phi:ti,angle:tn,radians:th,hexSize:45,hexOneThird:1/3*45,hexTwoThird:te,iso:ta,depth:t=>ta(t).y,angle:tn,a:(t,s)=>Math.atan2(s.y-t.y,s.x-t.x)/Math.PI*360,distance:(t,s)=>{let i=t.x-s.x,e=t.y-s.y;return Math.sqrt(i*i+e*e)}};class to extends o(){constructor(t=1,s=16777215,i=1){var e;super(),e=this,this.onMouseDown=t=>{this.addEventListener(f().MOUSE_DOWN,()=>{t(this)})},this.onRollOver=t=>{this.addEventListener(f().ROLL_OVER,()=>{t(this)})},this.onRollOut=t=>{this.addEventListener(f().ROLL_OUT,()=>{t(this)})},this.add=t=>{this.content=t,this.content.mask=this.s,t.width=this.s.width,t.height=this.s.height,t.x-=t.width/2,this.addChild(this.content)},this.dot=()=>{this.s.graphics.moveTo(0,0),this.s.graphics.lineTo(0,0)},this.hexagon=()=>{this.s.graphics.beginFill(16777215,.3);let t=0,s=0;this.s.graphics.moveTo(t,s),t+=td.hexTwoThird,s+=td.hexOneThird,this.s.graphics.lineTo(t,s),s+=td.hexTwoThird,this.s.graphics.lineTo(t,s),t-=td.hexTwoThird,s+=td.hexOneThird,this.s.graphics.lineTo(t,s),t-=td.hexTwoThird,s-=td.hexOneThird,this.s.graphics.lineTo(t,s),s-=td.hexTwoThird,this.s.graphics.lineTo(t,s),t+=td.hexTwoThird,s-=td.hexOneThird,this.s.graphics.lineTo(t,s),this.s.graphics.endFill()},this.cube=t=>{let s=1/3*t,i=2/3*t,e=0,h=0;this.s.graphics.moveTo(e,h),e+=i,h+=s,this.s.graphics.lineTo(e,h),h+=i,this.s.graphics.lineTo(e,h),e-=i,h+=s,this.s.graphics.lineTo(e,h),e-=i,h-=s,this.s.graphics.lineTo(e,h),h-=i,this.s.graphics.lineTo(e,h),e+=i,h-=s,this.s.graphics.lineTo(e,h)},this.tile=t=>{this.s.graphics.lineStyle(1,16777215,0),this.s.graphics.beginFill(16777215,0);let s=1/3*t,i=2/3*t,e=0,h=0;this.s.graphics.moveTo(e,h),e+=i,h+=s,this.s.graphics.lineTo(e,h),e-=i,h+=s,this.s.graphics.lineTo(e,h),e-=i,h-=s,this.s.graphics.lineTo(e,h),e+=i,h-=s,this.s.graphics.lineTo(e,h),this.s.graphics.endFill()},this.addLines=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16777215,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e.lines=new(tt()),e.lines.graphics.lineStyle(t,s,i),e.addChild(e.lines);let h=0,a=0;e.lines.graphics.moveTo(h,a),h+=td.hexTwoThird,a+=td.hexOneThird,e.lines.graphics.lineTo(h,a),a+=td.hexTwoThird,e.lines.graphics.lineTo(h,a),h-=td.hexTwoThird,a+=td.hexOneThird,e.lines.graphics.lineTo(h,a),h-=td.hexTwoThird,a-=td.hexOneThird,e.lines.graphics.lineTo(h,a),a-=td.hexTwoThird,e.lines.graphics.lineTo(h,a),h+=td.hexTwoThird,a-=td.hexOneThird,e.lines.graphics.lineTo(h,a)},this.addShadow=()=>{this.shadow=new(tt()),this.shadow.graphics.lineStyle(0,0,0),this.addChild(this.shadow);let t=0,s=td.hexTwoThird;this.shadow.graphics.beginFill(0,.5),this.shadow.graphics.moveTo(t,s),t+=td.hexTwoThird,s-=td.hexOneThird,this.shadow.graphics.lineTo(t,s),s+=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),t-=td.hexTwoThird,s+=td.hexOneThird,this.shadow.graphics.lineTo(t,s),s-=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),this.shadow.graphics.endFill(),t=0,s=td.hexTwoThird,this.shadow.graphics.beginFill(0,.8),this.shadow.graphics.moveTo(t,s),s+=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),t-=td.hexTwoThird,s-=td.hexOneThird,this.shadow.graphics.lineTo(t,s),s-=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),t+=td.hexTwoThird,s+=td.hexOneThird,this.shadow.graphics.lineTo(t,s),this.shadow.graphics.endFill()},this.addInverseShadow=()=>{this.shadow=new(tt()),this.shadow.graphics.lineStyle(0,0,0),this.addChild(this.shadow);let t=-td.hexTwoThird,s=td.hexOneThird;this.shadow.graphics.beginFill(0,.5),this.shadow.graphics.moveTo(t,s),t+=td.hexTwoThird,s-=td.hexOneThird,this.shadow.graphics.lineTo(t,s),s+=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),t-=td.hexTwoThird,s+=td.hexOneThird,this.shadow.graphics.lineTo(t,s),s-=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),this.shadow.graphics.endFill(),t=0,s=0,this.shadow.graphics.beginFill(0,.8),this.shadow.graphics.moveTo(t,s),t+=td.hexTwoThird,s+=td.hexOneThird,this.shadow.graphics.lineTo(t,s),s+=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),t-=td.hexTwoThird,s-=td.hexOneThird,this.shadow.graphics.lineTo(t,s),s-=td.hexTwoThird,this.shadow.graphics.lineTo(t,s),this.shadow.graphics.endFill()},this.circle=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a.GradientType.RADIAL,new a.Matrix,e.s.graphics.lineStyle(0,e.color,0),e.s.graphics.beginFill(s,1),e.s.graphics.drawCircle(0,0,t),e.s.graphics.endFill()},this.glow=()=>{let t=new a.GlowFilter(16777215,1,6,6,6,1,!1,!1);this.s.filters=[t]},this.rectangle=(t,s)=>{this.s.graphics.lineStyle(1,this.color,0),this.s.graphics.beginFill(this.color,this.alpha),this.s.graphics.moveTo(0,0),this.s.graphics.lineTo(t,0),this.s.graphics.lineTo(t,s),this.s.graphics.lineTo(0,s),this.s.graphics.lineTo(0,0),this.s.graphics.endFill()},this.color=s,this.alpha=i,this.s=new(tt()),this.s.graphics.lineStyle(t,s,i),this.addChild(this.s)}}var tl=i(46335),tr=i.n(tl),tc=i(46404),tp=i.n(tc);class tg extends o(){constructor(t,s,i,e,h){super(),this.add=t=>{this.tilemap.addTile(t),this.tiles.push(t)},this.clear=()=>{this.tiles.forEach(t=>{this.tilemap.removeTile(t)}),this.tiles=[]},this.getTileAt=t=>this.tilemap.getTileAt(t),this.tiles=[],this.tileset=new(tp())(t),this.tileWidth=Math.round(t.width/s),this.tileHeight=Math.round(t.height/i);for(let t=0;t<s;t+=1)for(let s=0;s<i;s+=1)this.tileset.addRect(new(J())(t*this.tileWidth,s*this.tileHeight,this.tileWidth,this.tileHeight));this.tilemap=new(tr())(e,h,this.tileset),this.tilemap.tileAlphaEnabled=!1,this.tilemap.tileColorTransformEnabled=!1,this.addChild(this.tilemap)}}var tm=i(52287),ty=i.n(tm);class tu extends ty(){}class tw{constructor(t,s,i){this.type=t,this.init=s,this.dispose=i}}class tx{constructor(){this.add=(t,s,i)=>{let e=new tw(t,s,i);this.states.push(e)},this.set=t=>{if(this.stateType===t)return;this.state&&(this.state.dispose(),this.state=null,this.stateType="");let s=this.states.find(s=>s.type===t);s&&(this.stateType=t,this.state=s,this.state.init())},this.reload=()=>{let t=this.stateType;this.state&&(this.state.dispose(),this.state=null,this.stateType=""),this.set(t)},this.dispose=()=>{this.state&&(this.state.dispose(),this.state=null,this.stateType="")},this.states=[],this.stateType="",this.state=null}}class tb extends o(){constructor(t=()=>{}){super(),this.onMouseMove=()=>{if(this.moveX){let t=this.stage.mouseX/n.scale-this.width/2-this.offsetX;this.maxX&&t>this.maxX&&(t=this.maxX),t<0&&(t=0),this.x=t}this.moveY&&(this.y=this.stage.mouseY/n.scale-this.height/2),this.callback()},this.onMouseDown=()=>{this.isDragging=!0,this.stage.addEventListener(f().MOUSE_UP,this.onMouseUp),this.stage.addEventListener(f().MOUSE_MOVE,this.onMouseMove),this.stage.addEventListener(f().MOUSE_LEAVE,this.onMouseUp)},this.onMouseUp=()=>{this.isDragging=!1,this.stage.removeEventListener(f().MOUSE_UP,this.onMouseUp),this.stage.removeEventListener(f().MOUSE_MOVE,this.onMouseMove),this.stage.removeEventListener(f().MOUSE_LEAVE,this.onMouseUp)},this.isDragging=!1,this.moveX=!0,this.moveY=!0,this.maxX=0,this.maxY=0,this.offsetX=0,this.offsetY=0,this.callback=t,this.addEventListener(f().MOUSE_DOWN,this.onMouseDown)}}class tv extends o(){constructor(){super(),this.add=t=>{this.sm.add(this.content.length,()=>{this.current=this.content[this.index],this.addChild(this.current)},()=>{this.removeChild(this.current),this.current=null}),this.content.push(t),this.current||this.sm.set(this.index)},this.next=()=>{this.index+=1,this.index>=this.content.length&&(this.index=0),this.sm.set(this.index)},this.prev=()=>{this.index-=1,this.index<0&&(this.index=this.content.length-1),this.sm.set(this.index)},this.content=[],this.index=0,this.current=null,this.sm=new tx}}class tE extends o(){constructor(t="grid/default.png"){let s;super(),this.setSize=(t,s)=>{this.images[1].x=this.images[0].width,this.images[1].width=t-2*this.images[0].width,this.images[2].x=this.images[1].x+this.images[1].width,this.images[3].height=s-2*this.images[0].height,this.images[3].y=this.images[0].height,this.images[4].x=this.images[0].width,this.images[4].y=this.images[0].height,this.images[4].width=t-2*this.images[0].width,this.images[4].height=s-2*this.images[0].height,this.images[5].height=s-2*this.images[0].height,this.images[5].y=this.images[0].height,this.images[5].x=this.images[2].x,this.images[6].y=this.images[3].y+this.images[3].height,this.images[7].width=this.images[1].width,this.images[7].y=this.images[6].y,this.images[7].x=this.images[0].width,this.images[8].y=this.images[7].y,this.images[8].x=this.images[7].x+this.images[7].width},this.path=t,this.images=[];for(let i=0;i<3;i+=1)for(let e=0;e<3;e+=1)(s=new Z(t,3,3)).setIndexX(e),s.setIndexY(i),this.addChild(s),this.images.push(s)}}class tT extends o(){constructor(t,s=()=>{}){super(),this.add=t=>{this.content.addChild(t),this.bg.setSize(this.content.width,this.content.height),this.highlight.setSize(this.content.width,this.content.height)},this.addText=t=>{let s=new N(t,I.F,10);s.x=3,s.y=1,this.content.addChild(s),this.bg.setSize(this.content.width+8,this.content.height),this.highlight.setSize(this.content.width+8,this.content.height)},this.setWidth=t=>{this.highlight.setSize(t,this.content.height),this.bg.setSize(t,this.content.height)},this.showHighlight=()=>{this.highlight.visible=!0},this.hideHighlight=()=>{this.highlight.visible=!1},this.callback=s,this.bg=new tE(t),this.addChild(this.bg),this.highlight=new tE("grid/btnHighlight.png"),this.addChild(this.highlight),this.highlight.visible=!1,this.content=new(o()),this.addChild(this.content),this.addEventListener(f().MOUSE_DOWN,()=>{s()}),this.addEventListener(f().ROLL_OVER,()=>{this.showHighlight()}),this.addEventListener(f().ROLL_OUT,()=>{this.hideHighlight()}),this.mouseChildren=!1}}class tD extends o(){constructor(t="grid/modal.png"){super(),this.add=t=>{this.container.add(t),this.grid.setSize(this.container.content.width+this.padding,this.container.content.height+this.padding),this.container.centerContent(),this.container.centerBackground()},this.dispose=()=>{b.removeEntity(this.container)},this.padding=0,this.container=new S,this.container.layer="modal",b.addEntity(this.container),this.grid=new tE(t),this.container.setBackground(this.grid)}}class tf extends o(){constructor(t){super(),this.init=t=>{this.drag.offsetX=this.x,this.drag.x=t},this.border=new tE("grid/dark.png"),this.border.setSize(110,10),this.addChild(this.border),this.drag=new tb(()=>{t(this.drag.x),this.text.setText(this.drag.x.toString())}),this.drag.moveY=!1,this.drag.maxX=100;let s=new V("handle.png");this.drag.addChild(s),this.addChild(this.drag),this.text=new N("50",I.F,10,15658734),this.addChild(this.text),this.text.x=110,this.text.y-=2}}var tS=i(90393),tB=i.n(tS);class tL extends o(){constructor(t="label"){super(),this.add=t=>{this.menu.add(t),this.updateSize()},this.addButton=(t,s)=>{let i=new tT("transparent.png",()=>{s(),b.showOverlay(this.content),b.enableKeys(this)});i.addText(t),this.add(i)},this.updateSize=()=>{let t=this.content.width>this.btn.width?this.content.width:this.btn.width,{height:s}=this.menu;this.bg.setSize(t,s),this.menu.setWidth(t)},this.enableKeyNavigation=()=>{this.keySubscription=p.subscribe(g.KEY_DOWN,t=>{this.keyDown(t)})},this.disableKeyNavigation=()=>{p.remove(this.keySubscription)},this.keyDown=t=>{switch(t){case 38:b.showOverlay(this.content),b.enableKeys(this),this.menu.previous(),this.menu.selected.callback();break;case 40:b.showOverlay(this.content),b.enableKeys(this),this.menu.next(),this.menu.selected.callback();break;default:b.showOverlay(this.content),b.enableKeys(this)}},this.btn=new tT("grid/dropdown.png",()=>{let t=this.localToGlobal(new(tB())(0,0));this.content.x=t.x/n.scale,this.content.y=t.y/n.scale+this.btn.height,b.showOverlay(this.content),b.enableKeys(this)}),this.btn.addText(t),this.addChild(this.btn),this.content=new(o()),this.bg=new tE("grid/dark.png"),this.content.addChild(this.bg),this.menu=new M,this.menu.vertical(),this.content.addChild(this.menu),this.caret=new Z("caret.png",2,1),this.caret.x=this.btn.width-4,this.caret.y=6,this.btn.add(this.caret),this.btn.setWidth(this.btn.width+4),this.btn.addEventListener(f().ROLL_OVER,()=>{this.caret.setIndexX(1)}),this.btn.addEventListener(f().ROLL_OUT,()=>{this.caret.setIndexX(0)})}}var tC={toggle:()=>new tv,tower:()=>{let t=new Tower;return b.addEntity(t),t},container:(t,s)=>{let i=new S(t);return s&&(i.layer=s),b.addEntity(i),i},textButton:(t,s,i)=>{let e=new tT(i,s);return e.addText(t),e},imageButton:(t,s,i)=>{let e=new tT(i,s),h=new V(t);return e.add(h),e},menu:()=>new M,image:t=>new V(t),text:(t,s,i,e)=>new N(t,s,i,e),input:(t,s,i,e)=>new Y(t,s,i,e),animation:(t,s)=>{let i=new Animation(t,s);return b.addEntity(i),i},spritesheet:(t,s,i,e)=>new Z(t,s,i,e),bitmap:(t,s)=>new Q(t,s),shape:(t,s,i)=>new to(t,s,i),tile:t=>new tu(t),interval:(t,s)=>new L(t,s),box:(t,s)=>{let i=new Box(t,s);return b.addEntity(i),i},draw:(t,s,i)=>{let e=new B(t,s,i);return b.addEntity(e),e},tilemap:(t,s,i,e,h)=>new tg(t,s,i,e,h),stateMachine:()=>new tx,grid:t=>new tE(t),modal:t=>new tD(t),drag:t=>new tb(t),steps:t=>new tf(t),dropdown:t=>new tL(t),body:function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"dynamic",h=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return{bullet:t,linearDamping:s,angularDamping:i,type:e,allowSleep:h}},fixture:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return{friction:t,restitution:s,density:i,userData:{id:e},filter:{maskBits:h,categoryBits:a},isSensor:n}},planckBox:(t,s)=>y.Box(t,s),planckCircle:t=>y.Circle(t)};class tM extends o(){constructor(){super(),this.subscribeToMessages=()=>{p.subscribe(g.SHOW_LAYER,this.showLayer),p.subscribe(g.HIDE_LAYER,this.hideLayer),p.subscribe(g.SET_SCALE,this.setScale)},this.showLayer=t=>{let s=this.layers[t];s&&(s.visible=!0)},this.hideLayer=t=>{let s=this.layers[t];s&&(s.visible=!1)},this.setScale=()=>{this.scaleX=n.scale,this.scaleY=n.scale},this.getLayer=t=>{var s;return null!==(s=this.layers[t])&&void 0!==s?s:this.addLayer(t)},this.addLayer=t=>{let s=new(o());return this.layers[t]=s,this.content.addChild(s),this.sort(),s},this.render=t=>{this.bm.draw(t)},this.add=t=>{this.getLayer(t.layer).addChild(t)},this.remove=t=>{this.getLayer(t.layer).removeChild(t)},this.setMousePos=(t,s)=>{n.mouseX=t,n.mouseY=s},this.onMouseMove=t=>{this.setMousePos(t.stageX,t.stageY)},this.onMouseDown=t=>{this.setMousePos(t.stageX,t.stageY),this.setMousePos(t.stageX,t.stageY),n.mouseDown=!0},this.onMouseUp=()=>{n.mouseDown=!1},this.onMouseLeave=()=>{n.mouseDown=!1},this.fill=t=>{this.background.graphics.beginFill(t),this.background.graphics.drawRect(0,0,n.width,n.height),this.background.graphics.endFill()},this.clear=()=>{this.bm.clear()},this.sort=()=>{let t=[];for(let s in this.layers)t.push(this.layers[s]);for(let s of t.sort((t,s)=>t.layer>s.layer?1:t.layer<s.layer?-1:0))this.content.addChild(s)},this.background=new(o()),this.addChild(this.background),this.content=new(o()),this.addChild(this.content),this.bm=tC.bitmap(n.width,n.height),this.bm.blendMode=a.BlendMode.ALPHA,this.addChild(this.bm),new a.GlowFilter(12330803,1,5,5,5,1,!0,!1),this.layers={},this.addEventListener(f().MOUSE_MOVE,this.onMouseMove),this.addEventListener(f().MOUSE_DOWN,this.onMouseDown),this.addEventListener(f().MOUSE_UP,this.onMouseUp),this.addEventListener(f().MOUSE_LEAVE,this.onMouseLeave),this.subscribeToMessages(),this.setScale(n.scale)}}class tO extends o(){constructor(){super(),this.show=t=>{if(this.content&&(this.removeChild(this.content),this.content===t)){this.content=null;return}this.content=t,this.addChild(this.content)},this.hide=()=>{this.content&&(this.removeChild(this.content),this.content=null)},this.setScale=t=>{this.scaleX=t,this.scaleY=t},this.content=null,this.setScale(n.scale),p.subscribe(g.SHOW_OVERLAY,this.show),p.subscribe(g.HIDE_OVERLAY,this.hide),p.subscribe(g.SET_SCALE,this.setScale)}}var tA={FIBONACCI:"fibonacci",DRAW:"draw",COLLISION:"collision",Suica:"suica"};class tF extends E{constructor(){super(),this.init=()=>{}}}var tk=tF;class tP extends E{constructor(t,s){super(),this.clamp=(t,s,i)=>Math.min(Math.max(t,s),i),this.update=()=>{let t=this.x-n.mouseX/n.scale,s=this.y-n.mouseY/n.scale,i=Math.sqrt(t*t+s*s),e={x:t/i,y:s/i},h=this.clamp(1/this.repulseRadius*(-1*(i/this.repulseRadius)**2+1)*this.repulseRadius*this.velocity,0,50);this.x+=e.x*h,this.y+=e.y*h;let a=this.orig.x-this.x,d=this.orig.y-this.y,o=Math.sqrt(a*a+d*d);if(0===o)return;if(o<1){this.x=this.orig.x,this.y=this.orig.y;return}let l={x:a/o*1.5,y:d/o*1.5};this.x+=l.x,this.y+=l.y,this.img.rotation=180*Math.atan((this.y-n.height/2)/(this.x-n.width/2))/Math.PI};let i=tC.image("leaf/leaf.png"),e=360-360/td.phi,h=Math.sqrt(t),a=e*t/(180/Math.PI),d={x:9*h*Math.cos(a)+n.width/2,y:9*h*Math.sin(a)+n.height/2};i.rotation=a/Math.PI*180,i.alpha=0,i.center(),this.repulseRadius=500,this.velocity=1.6,this.img=i,this.addChild(i),this.orig=d,this.x=d.x+50*Math.cos(a),this.y=d.y+50*Math.sin(a)}}let t_={0:4021145,1:12330803,2:15555914,3:7600831,4:5013398,5:4890056,bg:0};class tI extends tk{constructor(){super(),this.setTheme=t=>{this.theme=t;let s=this.theme.bg;this.container.fill(s),this.clear(),this.addLeaves()},this.clear=()=>{this.leaves.forEach(t=>{t.parent.removeChild(t)}),this.leaves=[],this.origs=[],clearInterval(this.interval)},this.addLeaves=()=>{let t;this.interval=setInterval(()=>{let s=new tP(t=this.leaves.length+1,this.getColor(t));this.leaves.push(s),b.addEntity(s),this.container.add(s),t>500&&clearInterval(this.interval)},10)},this.getColor=t=>t%12==0?this.theme["5"]:t%10==0?this.theme["4"]:t%8==0?this.theme["3"]:t%5==0?this.theme["2"]:t%3==0?this.theme["1"]:this.theme["0"],this.update=()=>{this.leaves.forEach(t=>{t.update()})},this.dispose=()=>{this.clear(),b.removeEntity(this.container),b.removeEntity(this.menu)},this.leaves=[],this.origs=[],this.container=tC.container(),this.menu=tC.menu(),this.container.add(this.menu),this.menu.y=30,this.setTheme(t_),this.menu.y=n.height-this.menu.height,this.container.center()}}class tN extends tk{constructor(){super(),this.dispose=()=>{b.removeEntity(this.container)},this.w=150,this.h=150,this.container=tC.container(),this.bm=tC.bitmap(this.w,this.h),this.bm.x=20,this.bm.y=20,this.container.add(this.bm),this.draw1=tC.draw(this.bm,70,70),this.draw2=tC.draw(this.bm,70,70),this.draw3=tC.draw(this.bm,70,70),this.draw4=tC.draw(this.bm,70,70)}}var tY={NONE:"none",LEFT:0,LEFT_UP:1,UP:2,UP_RIGHT:3,RIGHT:4,RIGHT_DOWN:5,DOWN:6,DOWN_LEFT:7};class tR{constructor(t){this.keys=()=>{p.subscribe(g.KEY_DOWN,this.onKeyDown),p.subscribe(g.KEY_UP,this.onKeyUp)},this.onKeyDown=t=>{this.isWalkingKey(t)&&(this.updateDirection(),this.updateSpeed()),this.isShootinggKey(t)&&(this.model.isShooting=!0)},this.onKeyUp=t=>{this.isWalkingKey(t)&&(this.model.isWalking=this.isWalking(),this.model.isWalking?(this.updateDirection(),this.updateSpeed()):(this.model.setDirection(tY.NONE),this.model.setSpeed(0,0))),this.isShootinggKey(t)&&(this.model.isShooting=this.isShooting())},this.isShootinggKey=t=>this.model.shootingKeys.find(s=>s===t),this.isWalkingKey=t=>this.model.walkingKeys.find(s=>s===t),this.updateSpeed=()=>{let t=this.model.getDirection();if(t===tY.NONE){this.model.setSpeed(0,0);return}switch(t){case tY.LEFT:this.model.setSpeed(-this.model.speed,0);break;case tY.LEFT_UP:this.model.setSpeed(-this.model.speed/2,-this.model.speed/2);break;case tY.UP:this.model.setSpeed(0,-this.model.speed);break;case tY.UP_RIGHT:this.model.setSpeed(this.model.speed/2,-this.model.speed/2);break;case tY.RIGHT:this.model.setSpeed(this.model.speed,0);break;case tY.RIGHT_DOWN:this.model.setSpeed(this.model.speed/2,this.model.speed/2);break;case tY.DOWN:this.model.setSpeed(0,this.model.speed);break;case tY.DOWN_LEFT:this.model.setSpeed(-this.model.speed/2,this.model.speed/2)}},this.updateDirection=()=>{let t=this.getDirection();this.model.setDirection(t)},this.getDirection=()=>{let t=tY.NONE;return(x.key(38)||x.key(87))&&(t=tY.UP),(x.key(40)||x.key(83))&&(t=tY.DOWN),(x.key(37)||x.key(65))&&(t=t===tY.UP?tY.LEFT_UP:t===tY.DOWN?tY.DOWN_LEFT:tY.LEFT),(x.key(39)||x.key(68))&&(t=t===tY.UP?tY.UP_RIGHT:t===tY.DOWN?tY.RIGHT_DOWN:tY.RIGHT),t},this.getDirectionToPoint=(t,s)=>{let i=tY.NONE;return t.y>s.y&&(i=tY.UP),t.y<s.y&&(i=tY.DOWN),t.x>s.x&&(i=i===tY.UP?tY.LEFT_UP:i===tY.DOWN?tY.DOWN_LEFT:tY.LEFT),t.x<s.x&&(i=i===tY.UP?tY.UP_RIGHT:i===tY.DOWN?tY.RIGHT_DOWN:tY.RIGHT),i},this.setDirection=t=>{this.model.setDirection(t)},this.moveToPoint=(t,s)=>{let i=td.radians(t,s),e=this.model.speed*Math.cos(i),h=this.model.speed*Math.sin(i);this.model.setSpeed(e,h)},this.isWalking=()=>(this.model.walkingKeys.forEach(t=>x.key(t)),!1),this.isShooting=()=>(this.model.shootingKeys.forEach(t=>x.key(t)),!1),this.stop=()=>{this.model.setDirection(tY.NONE),this.model.setSpeed(0,0)},this.dispose=()=>{p.unsubscribe(g.KEY_DOWN,this.onKeyDown),p.unsubscribe(g.KEY_DOWN,this.onKeyDown)},this.model=t}}let tW=0,tU=0,tK=0,tV=0,tH=tY.NONE,tX=t=>{tH=t};var tz={xSpeed:tK,ySpeed:tV,speed:100,setSpeed:(t,s)=>{tK=t,tV=s},getSpeed:()=>({x:tK,y:tV}),isWalking:!1,walkingKeys:[37,38,39,40,65,68,83,87],isShooting:!1,shootingKeys:[32],resetDirection:()=>{tX(tY.NONE)},getDirection:()=>tH,setDirection:tX,getPosition:()=>({x:tW,y:tU}),setPosition:(t,s)=>{tW=t,tU=s}};class tG{constructor(){this.getSpeed=()=>({x:this.xSpeed,y:this.ySpeed}),this.setSpeed=(t,s)=>{this.xSpeed=t,this.ySpeed=s},this.resetDirection=()=>{this.setDirection(tY.NONE)},this.getDirection=()=>this.direction,this.setDirection=t=>{this.direction=t},this.speed=10,this.xSpeed=0,this.ySpeed=0,this.isWalking=!1,this.isShooting=!1,this.direction=tY.NONE,this.walkingKeys=[],this.shootingKeys=[]}}var tq={IDLE:"idle",WALK:"walk"},tZ={WALL:1,PLAYER:2,PARTICLE:3,ENEMY:4,SUICA:5};class tj extends E{constructor(){super(),this.init=()=>{let t=tC.body(!0,.2,2,"dynamic",!1),s=tC.fixture(0,0,0,this.id,tZ.WALL|tZ.ENEMY,tZ.PARTICLE,!1),i=tC.planckCircle(this.width/2);b.createBody(this,i,t,s)},this.vel=(t,s)=>{this.velocity=y.Vec2(t*this.speed,s*this.speed)},this.addBody=t=>{this.body=t;let s=y.Vec2(this.x,this.y);this.body.setPosition(s),this.body.setLinearVelocity(this.velocity)},this.handleCollision=t=>{if(t&&!t.remove)switch(t.type){case u.ENEMY:break;case u.WALL:this.remove=!0}},this.update=t=>{this.interval.update(t);let s=this.body.getPosition();this.x=s.x,this.y=s.y,(this.x<0||this.y<0||this.x>n.width||this.y>n.height)&&(this.remove=!0)},this.dispose=()=>{b.destroyBody(this.body)},this.type=u.PARTICLE,this.speed=1e3,this.damage=10,this.view=!0,this.velocity=null,this.ss=new Z("collision/projectile.png",2,1),this.ss.x-=this.ss.width/2,this.ss.y-=this.ss.height/2,this.addChild(this.ss),this.interval=tC.interval(10,()=>{this.ss.stepX()})}}class tJ extends E{constructor(t){super(),this.init=()=>{let t=tC.body(!0,1,1),s=tC.fixture(1,.99,1,this.id,tZ.ENEMY|tZ.WALL,tZ.PLAYER),i=tC.planckCircle(this.width/2);b.createBody(this,i,t,s),this.CM.setPosition(this.x,this.y)},this.shoot=()=>{let t=new tj;t.x=this.x,t.y=this.y;let s=this.facing/8*Math.PI*2+Math.PI,i=3*Math.cos(s),e=3*Math.sin(s);t.x+=(this.width+10)*Math.cos(s)/2,t.y+=(this.height+10)*Math.sin(s)/2,t.rotation=this.facing/8*360-90,t.vel(i,e),b.addEntity(t)},this.update=t=>{let s=this.CM.getSpeed(),i=y.Vec2(s.x,s.y);this.body.setLinearVelocity(i);let e=this.body.getPosition();this.x=e.x,this.y=e.y,this.CM.setPosition(e.x,e.y);let h=this.CM.getDirection();this.CM.getDirection()!==tY.NONE?(this.facing=h,this.sm.set(tq.WALK)):this.sm.set(tq.IDLE),this.facing!==tY.NONE&&this.ss.setIndexX(this.facing),this.CM.isShooting&&this.shooting.update(t)},this.dispose=()=>{this.shooting&&b.removeEntity(this.shooting)},this.view=!0,this.facing=0,this.layer=3,this.type=u.PLAYER,this.CM=t,this.shooting=tC.interval(20,this.shoot),this.sm=tC.stateMachine(),this.sm.add(tq.IDLE,()=>{this.ss=tC.spritesheet("tv/tv_idle.png",8,1,150),this.ss.setIndexX(this.facing),this.addChild(this.ss),this.ss.x-=this.ss.width/2,this.ss.y-=this.ss.height/2},()=>{this.removeChild(this.ss)}),this.sm.add(tq.WALK,()=>{this.ss=tC.spritesheet("tv/tv_walk.png",8,4,150),this.ss.setIndexX(this.facing),this.addChild(this.ss),this.ss.x-=this.ss.width/2,this.ss.y-=this.ss.height/2,this.ss.play()},()=>{this.removeChild(this.ss)}),this.sm.set(tq.IDLE)}}class tQ extends E{constructor(t){super(),this.update=()=>{this.y-=1,this.time+=1,this.time>20&&b.removeEntity(this)},this.time=0,this.view=!0;let s=tC.text(t.toString(),I.ATTRACT,14,0);this.addChild(s)}}class t$ extends E{constructor(t="target.png",s,i){super(),this.init=()=>{let t=tC.body(!0,1,1),s=tC.fixture(.5,.99,1,this.id,tZ.PARTICLE,tZ.ENEMY),i=tC.planckCircle(this.width/2);b.createBody(this,i,t,s)},this.setPath=t=>{this.path=t},this.damage=t=>{this.hp-=t,this.hp<=0&&(this.remove=!0);let s=new tQ(t);s.x=this.x,s.y=this.y,b.addEntity(s)},this.handleCollision=t=>{t&&!t.remove&&t.type===u.PARTICLE&&this.damage(t.damage)},this.update=t=>{t%100&&this.path.findPath(this,this.playerModel.getPosition()),this.path.update(t);let s=this.model.getSpeed(),i=y.Vec2(s.x,s.y);this.body.setLinearVelocity(i);let e=this.body.getPosition();this.x=e.x,this.y=e.y},this.dispose=()=>{b.destroyBody(this.body)},this.model=s,this.playerModel=i,this.type=u.ENEMY,this.view=!0,this.hp=50,this.i=tC.image(t),this.i.y-=this.i.height/2,this.i.x-=this.i.width/2,this.addChild(this.i)}}class t0 extends E{constructor(){super(),this.init=()=>{let t=tC.body(!0,1,1,"static"),s=tC.fixture(1,.99,1,this.id,tZ.PLAYER|tZ.PARTICLE|tZ.ENEMY,tZ.WALL),i=tC.planckBox(this.width/2,this.height/2);b.createBody(this,i,t,s)},this.handleCollision=t=>!t||t.remove?void 0:void t.type,this.addBody=t=>{this.body=t;let s=y.Vec2(this.x+this.width/2,this.y+this.width/2);this.body.setPosition(s)},this.dispose=()=>{b.destroyBody(this.body)},this.view=!0,this.layer=2,this.physics=!0,this.fixed=!0,this.type=u.WALL,this.maskBits=u.PLAYER|u.PARTICLE,u.ENEMY,this.categoryBits=u.WALL,this.i=tC.image("collision/wall.png"),this.addChild(this.i)}}class t1 extends E{constructor(t,s,i){super(),this.tilePos=()=>({x:this.tileX,y:this.tileY}),this.tileX=t,this.tileY=s,this.layer=3,this.view=!0,this.hover=tC.image("collision/hover.png"),this.addChild(this.hover),this.hover.visible=!1,this.s=tC.shape(),this.s.rectangle(32,32),this.s.onMouseDown(()=>{i(this)}),this.s.onRollOver(()=>{this.hover.visible=!0}),this.s.onRollOut(()=>{this.hover.visible=!1}),this.addChild(this.s)}}var t2=i(9657),t3=i.n(t2);class t5{constructor(t,s,i){this.findPath=(t,s)=>{let i=this.grid.clone();return this.finder.findPath(t.x,t.y,s.x,s.y,i)},this.add=(t,s,i)=>{t.x=s*this.tileSize,t.y=i*this.tileSize},this.setWalkableAt=(t,s,i)=>{this.grid.setWalkableAt(t,s,i)},this.getTilePosition=(t,s)=>({x:t*this.tileSize,y:s*this.tileSize}),this.getTileCenter=(t,s)=>({x:t*this.tileSize+this.tileSize/2,y:s*this.tileSize+this.tileSize/2}),this.getTileAt=(t,s)=>({x:Math.floor(t/this.tileSize),y:Math.floor(s/this.tileSize)}),this.tileSize=t,this.width=s,this.height=i,this.finder=new(t3()).AStarFinder({allowDiagonal:!0,dontCrossCorners:!0}),this.grid=new(t3()).Grid(this.width,this.height)}}class t7{constructor(t,s,i){this.findPath=(t,s)=>{this.target=null;let i=this.map.getTileAt(t.x,t.y),e=this.map.getTileAt(s.x,s.y);this.path=this.map.findPath(i,e),this.nextTarget()},this.nextTarget=()=>{if(0===this.path.length){this.target=null,this.control.stop();return}let t=this.path.shift();this.setTarget(t)},this.setTarget=t=>{let s={x:t[0],y:t[1]},i=this.map.getTileAt(this.entity.x,this.entity.y),e=this.control.getDirectionToPoint(i,s);this.control.setDirection(e),this.target=this.map.getTileCenter(s.x,s.y),this.control.moveToPoint(this.entity.pos(),this.target)},this.isAtTarget=()=>20>td.distance(this.entity.pos(),this.target),this.update=()=>{this.target&&this.isAtTarget(this.target)&&this.nextTarget()},this.entity=t,this.map=s,this.control=i,this.path=null,this.target=null}}class t4 extends tk{constructor(){var t;super(),t=this,this.build=()=>{for(let t=0;t<this.map.width;t+=1)this.wall(t,0);for(let t=0;t<this.map.width;t+=1)this.wall(t,this.map.height-1);for(let t=1;t<this.map.height-1;t+=1)this.wall(0,t);for(let t=1;t<this.map.height-1;t+=1)this.wall(this.map.width-1,t);for(let t=1;t<this.map.width-1;t+=1)for(let s=1;s<this.map.height-1;s+=1)10*Math.random()<2?this.wall(t,s):this.floor(t,s)},this.add=(t,s,i)=>{this.map.add(t,s,i),this.items.push(t),b.addEntity(t)},this.wall=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.add(new t0,s,i),t.map.setWalkableAt(s,i,!1)},this.floor=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=new t1(s,i,s=>{t.target=null,t.path.findPath(t.player,s)});t.add(e,s,i)},this.enemy=(t,s,i)=>{let e=new tG,h=new tR(e),a=new t$(t,e,tz);a.setPath(new t7(a,this.map,h)),this.add(a,s,i)},this.update=t=>{this.enemySpawner.update(t),this.path.update(t)},this.dispose=()=>{b.removeEntity(this.p),b.removeEntity(this.walls),this.items.forEach(t=>{b.removeEntity(t)}),this.items=[],this.control.dispose()},this.items=[],this.control=new tR(tz),this.control.keys(),this.map=new t5(32,15,10),this.player=new tJ(tz),this.path=new t7(this.player,this.map,this.control),this.add(this.player,5,5),this.c=tC.container(),this.c.fill(9674381),this.m=tC.container(5),this.menu=tC.menu(),this.m.add(this.menu),this.menu.y=16,this.menu.add(tC.textButton("reset",()=>{this.items.forEach(t=>{b.removeEntity(t)}),this.items=[],b.removeType(u.PARTICLE),this.build()})),this.enemySpawner=tC.interval(100,()=>{let t=Math.floor(Math.random()*(this.map.width-4))+2,s=Math.floor(Math.random()*(this.map.height-4))+2;this.enemy("collision/enemy".concat(Math.floor(3*Math.random())+1,".png"),t,s)}),this.build()}}class t6 extends E{constructor(t,s){super(),this.init=()=>{let t=tC.body(!0,1,1,"static"),s=tC.fixture(1,.99,1,"wall",tZ.SUICA,tZ.WALL);s.userData={id:"wall",type:u.WALL};let i=tC.planckBox(this.width/2,this.height/2);b.createBody(this,i,t,s)},this.handleCollision=t=>{if(!t||t.remove)return},this.addBody=t=>{this.body=t;let s=y.Vec2(this.x+this.width/2,this.y+this.height/2);this.body.setPosition(s)},this.dispose=()=>{b.destroyBody(this.body)},this.view=!0,this.layer=2,this.physics=!0,this.fixed=!0,this.type=u.WALL,this.categoryBits=u.WALL,this.s=tC.shape(0,0,0),this.s.rectangle(t,s),this.addChild(this.s)}}class t8 extends E{constructor(t,s,i="dynamic"){super(),this.init=()=>{let t="dynamic"===this.bodyType?tZ.WALL|tZ.SUICA:tZ.SUICA,s=tC.body(!1,5,5,this.bodyType),i=tC.fixture(0,0,0,this.id,t,tZ.SUICA,!1);i.userData={id:this.id,level:this.level,type:u.SUICA};let e=tC.planckCircle(this.level/2,2);setTimeout(()=>{b.createBody(this,e,s,i)},0)},this.vel=(t,s)=>{this.velocity=y.Vec2(t*this.speed,s*this.speed)},this.addBody=t=>{this.body=t;let s=y.Vec2(this.x,this.y);this.body.setPosition(s),this.body.setLinearVelocity(this.velocity)},this.update=t=>{if(!this.body)return;let s=this.body.getPosition();this.x=s.x,this.y=s.y,(this.x<0||this.y<-50||this.x>n.width||this.y>n.height)&&(this.remove=!0)},this.dispose=()=>{this.removeBody()},this.type=u.SUICA,this.speed=20,this.damage=10,this.render=!0,this.velocity=1,this.level=t,this.bodyType=i;let e=new a.Sprite;this.addChild(e),this.s=tC.shape(0,12330803,1),this.s.circle(t/2+1,s),e.addChild(this.s);let h=new N(t.toString(),I.F,10);h.x=-h.width/2,h.y=-h.height/2}}class t9 extends tk{constructor(){super(),this.onCollision=t=>{if(t.uA.type===u.SUICA&&t.uB.type===u.SUICA){let s=this.balls[t.uA.id],i=this.balls[t.uB.id];if(!s||!i||s.level!==i.level||s.remove||i.remove)return;s.remove=!0,i.remove=!0,s.removeBody(),i.removeBody();let e=s.level+1,h={x:(s.x+i.x)/2,y:(s.y+i.y)/2};this.addBall(e,h,0);return}let s=t.uA.type===u.SUICA?this.balls[t.uA.id]:this.balls[t.uB.id];if(!s||s.remove)return;let i={x:s.x,y:s.y},e=s.level;s.remove=!0,s.removeBody(),setTimeout(()=>{let t=new t8(e,16777215,"static"),s=u.SUICA+this.counter;t.id=s,t.x=i.x,t.y=i.y,b.addEntity(t),this.balls[s]=t,this.counter++},10)},this.addBall=(t,s,i)=>{let e=new t8(t,16777215);e.id=u.SUICA+this.counter,e.x=s.x,e.y=s.y;let h=1.5*Math.PI,a=i*Math.cos(h),n=i*Math.sin(h);e.vel(a,n),b.addEntity(e),this.balls[e.id]=e,this.counter++},this.wall=(t,s,i,e)=>{let h=new t6(i,e);h.x=t,h.y=s,b.addEntity(h),this.entities.push(h)},this.clear=()=>{this.entities.forEach(t=>{t.parent.removeChild(t)}),this.entities=[],clearInterval(this.interval)},this.update=()=>{this.entities.forEach(t=>{t.update()})},this.dispose=()=>{this.clear(),b.removeEntity(this.container),b.removeEntity(this.menu)},this.entities=[],this.container=tC.container(t=>{let s={x:t.stageX/n.scale,y:t.stageY/n.scale};this.addBall(1,s,4)}),this.menu=tC.menu(),this.container.add(this.menu),this.map=new t5(32,10,10),this.counter=0,this.menu.y=n.height-this.menu.height,this.container.center(),this.balls={},this.s=tC.shape(0,12330803,1),this.s.rectangle(n.width,n.height),this.s.x=-n.width/2,this.s.y=-n.height/2,this.container.add(this.s),this.wall(0,n.height-10,n.width,10),this.wall(0,0,10,n.height-10),this.wall(n.width-10,0,10,n.height-10),p.subscribe(g.COLLISION,this.onCollision),setInterval(()=>{this.addBall(1,{x:Math.random()*(n.width-30)+15,y:-10},Math.floor(10*Math.random()+3))},1e3/l.fps);let t=new N("Julafton");t.y=-10+t.height/2-20,t.x=-t.width/2;let s=new N("2023");s.y=-10+s.height/2+t.height-20,s.x=-s.width/2,this.container.add(t),this.container.add(s),this.container.centerContent()}}class st{constructor(){this.onSetStateMessage=t=>{this.sm.set(t)},this.onSetScale=()=>{this.sm.reload()},p.subscribe(g.SET_STATE,this.onSetStateMessage),p.subscribe(g.SET_SCALE,this.onSetScale),this.sm=tC.stateMachine(),this.sm.add(tA.DRAW,()=>{this.state=new tN,b.addEntity(this.state)},()=>{b.removeEntity(this.state)}),this.sm.add(tA.FIBONACCI,()=>{this.state=new tI,b.addEntity(this.state)},()=>{b.removeEntity(this.state)}),this.sm.add(tA.COLLISION,()=>{this.state=new t4,b.addEntity(this.state)},()=>{b.removeEntity(this.state)}),this.sm.add(tA.Suica,()=>{this.state=new t9,b.addEntity(this.state)},()=>{b.removeEntity(this.state)})}}var ss=i(55438),si=i.n(ss);class se extends E{constructor(){super(),this.init=()=>{this.stage.addEventListener(si().KEY_DOWN,this.onKeyDown),this.stage.addEventListener(si().KEY_UP,this.onKeyUp)},this.onKeyDown=t=>{let{keyCode:s}=t;x.down(s),p.dispatch(g.KEY_DOWN,s)},this.onKeyUp=t=>{let{keyCode:s}=t;x.up(s),p.dispatch(g.KEY_UP,s)},this.onEnableKeys=t=>{if(this.keyTarget&&(this.keyTarget.disableKeyNavigation(),t===this.keyTarget)){this.keyTarget=null;return}this.keyTarget=t,this.keyTarget.enableKeyNavigation()},this.onDisableKeys=()=>{this.keyTarget&&(this.keyTarget.disableKeyNavigation(),this.keyTarget=null)},this.view=!0,this.keyTarget=null,p.subscribe(g.ENABLE_KEYS,this.onEnableKeys),p.subscribe(g.DISABLE_KEYS,this.onDisableKeys)}}class sh extends o(){constructor(){super(),this.view=new tM,this.overlay=new tO,this.engine=new m(this.view),this.states=new st,this.addChild(this.view),this.addChild(this.overlay),this.engine.start(),b.addEntity(new T),b.addEntity(new se),b.setState(tA.Suica)}}class sa extends a.Sprite{init(t){n.windowWidth=window.innerWidth,n.windowHeight=window.innerHeight,n.width=n.windowWidth/n.scale,n.height=n.windowHeight/n.scale;let s=new a.AssetManifest;s.addBitmapData("assets/pause.png"),s.addBitmapData("assets/resume.png"),s.addBitmapData("assets/collision/chest.png"),s.addBitmapData("assets/collision/hover.png"),s.addBitmapData("assets/collision/ring.png"),s.addBitmapData("assets/collision/projectile.png"),s.addBitmapData("assets/collision/enemy3.png"),s.addBitmapData("assets/collision/enemy3_death.png"),s.addBitmapData("assets/collision/enemy2.png"),s.addBitmapData("assets/collision/enemy2_death.png"),s.addBitmapData("assets/collision/enemy1.png"),s.addBitmapData("assets/collision/enemy1_death.png"),s.addBitmapData("assets/collision/gubb.png"),s.addBitmapData("assets/collision/enemy.png"),s.addBitmapData("assets/collision/wall.png"),s.addBitmapData("assets/cabin/kettle.png"),s.addBitmapData("assets/cabin/table0.png"),s.addBitmapData("assets/cabin/table1.png"),s.addBitmapData("assets/cabin/table2.png"),s.addBitmapData("assets/cabin/door0.png"),s.addBitmapData("assets/cabin/door1.png"),s.addBitmapData("assets/cabin/door2.png"),s.addBitmapData("assets/cabin/divide.png"),s.addBitmapData("assets/cabin/window0.png"),s.addBitmapData("assets/cabin/kitchen0.png"),s.addBitmapData("assets/cabin/kitchen1.png"),s.addBitmapData("assets/cabin/kitchen2.png"),s.addBitmapData("assets/cabin/kitchen3.png"),s.addBitmapData("assets/cabin/chimney3.png"),s.addBitmapData("assets/cabin/chimney2.png"),s.addBitmapData("assets/cabin/chimney1.png"),s.addBitmapData("assets/cabin/chimney0.png"),s.addBitmapData("assets/cabin/chimney.png"),s.addBitmapData("assets/cabin/bricks0.png"),s.addBitmapData("assets/cabin/bricks1.png"),s.addBitmapData("assets/cabin/bricks2.png"),s.addBitmapData("assets/cabin/ugn.png"),s.addBitmapData("assets/cabin/border.png"),s.addBitmapData("assets/cabin/wall.png"),s.addBitmapData("assets/cabin/wall2.png"),s.addBitmapData("assets/cabin/wall3.png"),s.addBitmapData("assets/cabin/wall4.png"),s.addBitmapData("assets/cabin/floor.png"),s.addBitmapData("assets/forest/logs.png"),s.addBitmapData("assets/forest/bushes.png"),s.addBitmapData("assets/forest/flowers.png"),s.addBitmapData("assets/forest/flowers2.png"),s.addBitmapData("assets/forest/grass.png"),s.addBitmapData("assets/forest/mushrooms.png"),s.addBitmapData("assets/forest/stones.png"),s.addBitmapData("assets/forest/stubs.png"),s.addBitmapData("assets/forest/tree_leaves.png"),s.addBitmapData("assets/forest/tree_stem.png"),s.addBitmapData("assets/forest/twigs.png"),s.addBitmapData("assets/hex/box_colors.png"),s.addBitmapData("assets/hex/j.jpg"),s.addBitmapData("assets/particle.png"),s.addBitmapData("assets/hex/hex_0.png"),s.addBitmapData("assets/hex/hex_1.png"),s.addBitmapData("assets/hex/hex_2.png"),s.addBitmapData("assets/tv/tv_idle.png"),s.addBitmapData("assets/tv/tv_walk.png"),s.addBitmapData("assets/tv/small_missile.png"),s.addBitmapData("assets/owl/owl_walk.png"),s.addBitmapData("assets/owl/owl_idle.png"),s.addBitmapData("assets/owl/owl_shoot.png"),s.addBitmapData("assets/owl/owl_particle.png"),s.addBitmapData("assets/leaf/leaf.png"),s.addBitmapData("assets/leaf/default.png"),s.addBitmapData("assets/leaf/sakura.png"),s.addBitmapData("assets/leaf/rose.png"),s.addBitmapData("assets/grid/btnHighlight.png"),s.addBitmapData("assets/grid/white.png"),s.addBitmapData("assets/grid/dropdown.png"),s.addBitmapData("assets/grid/highlight.png"),s.addBitmapData("assets/grid/border.png"),s.addBitmapData("assets/grid/thin.png"),s.addBitmapData("assets/grid/modal.png"),s.addBitmapData("assets/grid/dark.png"),s.addBitmapData("assets/grid/default.png"),s.addBitmapData("assets/rpg/character/knight.png"),s.addBitmapData("assets/rpg/character/rogue.png"),s.addBitmapData("assets/rpg/character/wizard.png"),s.addBitmapData("assets/caret.png"),s.addBitmapData("assets/handle.png"),s.addBitmapData("assets/transparent.png"),s.addBitmapData("assets/target.png"),s.addFont("04b03","assets/font/04b03.ttf"),s.addFont("OldWizard","assets/font/OldWizard.ttf"),s.addFont("SNESesque","assets/font/SNESesque.ttf"),s.addFont("Akinesia","assets/font/Akinesia.ttf"),s.addFont("Anguish","assets/font/Anguish.ttf"),s.addFont("Attract","assets/font/Attract.ttf"),s.addFont("Awake","assets/font/Awake.ttf"),s.addFont("Beggars","assets/font/Beggars.ttf"),s.addFont("cadillacs-and-dinosaurs","assets/font/cadillacs-and-dinosaurs.ttf"),s.addFont("Coffin","assets/font/Coffin.ttf"),s.addFont("Compassion","assets/font/Compassion.ttf"),s.addFont("Coulrophobia","assets/font/Coulrophobia.ttf"),s.addFont("Dandy","assets/font/Dandy.ttf"),s.addFont("Den","assets/font/Den.ttf"),s.addFont("Dereliction","assets/font/Dereliction.ttf"),s.addFont("DownfallExtended"),s.addFont("Downheartedness"),s.addFont("Eccentric"),s.addFont("Eighties"),s.addFont("Equipment"),s.addFont("EquipmentExtended"),s.addFont("Erosion"),s.addFont("EvenWorse"),s.addFont("Express"),s.addFont("F"),s.addFont("Fortification"),s.addFont("Ghibli"),s.addFont("Hurry"),s.addFont("Improbable"),s.addFont("Ineffective"),s.addFont("Inexpugnable"),s.addFont("Leaflets"),s.addFont("Mantimini"),s.addFont("Marksman"),s.addFont("Nocive"),s.addFont("OldWizard"),s.addFont("Pattern"),s.addFont("Pocket"),s.addFont("Postburn"),s.addFont("Quiver"),s.addFont("Rampike"),s.addFont("Rematch"),s.addFont("Remnant"),s.addFont("Rhyme"),s.addFont("Rings"),s.addFont("Rollback"),s.addFont("Safeguard"),s.addFont("Scherzo"),s.addFont("Shattered"),s.addFont("Sins"),s.addFont("SNESesque"),s.addFont("Suffering"),s.addFont("Targets"),s.addFont("TeatableExtended"),s.addFont("Theoretical"),s.addFont("Trollmini"),s.addFont("Turntable"),s.addFont("Warhorse"),s.addFont("Warpath"),s.addFont("Whatever"),s.addFont("Yellow"),s.addFont("Zankoku"),s.addFont("Zapper"),a.AssetLibrary.loadFromManifest(s).onComplete(s=>{a.Assets.registerLibrary("default",s);let i=new a.Stage(window.innerWidth,window.innerHeight,12330803,sh);t.appendChild(i.element)}).onError(t=>{console.error(t)})}}var sn=()=>(h.useEffect(()=>{new sa().init(document.getElementById("app"))},[]),(0,e.jsx)(e.Fragment,{}))}}]);