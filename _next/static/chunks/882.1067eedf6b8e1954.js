"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{36882:function(t,i,s){s.r(i),s.d(i,{default:function(){return io}});var e=s(85893),h=s(67294),n=s(41166),a={windowWidth:0,windowHeight:0,height:0,width:0,scale:6,mouseX:0,mouseY:0,mouseDown:!1},d=s(38167),o=s.n(d),l={fps:60,entityCount:0,worldStep:30};class r{constructor(t,i){this.messageType=t,this.callback=i}}class c{constructor(){var t=this;this.subscribe=(t,i)=>{let s=new r(t,i);return this.subscriptions.push(s),s},this.unsubscribe=(t,i)=>{let s=this.subscriptions.find(s=>s.messageType===t&&s.callback===i);s&&this.remove(s)},this.remove=t=>{let i=this.subscriptions.indexOf(t);this.subscriptions.splice(i,1)},this.clear=t=>{let i=this.subscriptions.filter(i=>i.messageType===t);for(let t in i)this.remove(t)},this.dispatch=function(i){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let e of t.subscriptions.filter(t=>t.messageType===i))e.callback(s)},this.subscriptions=[]}}let g=new c;var p={SET_STATE:"setState",ADD_ENTITY:"addEntity",REMOVE_ENTITY:"removeEntity",REMOVE_TYPE:"removeType",SET_SCALE:"setScale",SET_FPS:"setFPS",SHOW_LAYER:"showLayer",HIDE_LAYER:"hideLayer",SHOW_OVERLAY:"showOverlay",HIDE_OVERLAY:"hideOverlay",KEY_DOWN:"keyDown",KEY_UP:"keyUp",ENABLE_KEYS:"enableKeys",DISABLE_KEYS:"disableKeys",COLLISION:"collision",CREATE_BODY:"createBody",DESTROY_BODY:"destroyBody",PAUSE_APP:"pauseApp",RESUME_APP:"resumeApp"};class y{constructor(t){this.pause=()=>{this.paused=!0},this.resume=()=>{this.paused=!1},this.onSetFPS=()=>{this.stop(),this.delay=Math.round(1e3/l.fps),this.start()},this.addEntity=t=>{this.entities.push(t),0===t.id&&(t.id=l.entityCount),this.entities.push(t),t.view&&this.view.add(t),t.init(),l.entityCount++},this.removeEntity=t=>{if(!this.entities.find(i=>i===t))return;t.dispose();let i=this.entities.indexOf(t);this.entities.splice(i,1),t.view&&this.view.remove(t),l.entityCount-=1},this.removeType=t=>{this.entities.filter(i=>i.type===t).forEach(t=>{this.removeEntity(t)})},this.onCollision=t=>{let i=this.findById(t.uA.id),s=this.findById(t.uB.id);i&&s&&(i.handleCollision(s),s.handleCollision(i))},this.findById=t=>this.entities.find(i=>i.id===t),this.start=()=>{this.interval=setInterval(()=>{this.counter+=1,this.update(this.counter)},this.delay)},this.stop=()=>{clearInterval(this.interval)},this.update=t=>{!this.paused&&(this.view.clear(),this.entities.forEach(i=>{i.update(t),!i.remove&&i.render&&this.view.render(i)}),this.entities.forEach(t=>{t.remove&&this.remove.push(t)}),this.remove.length>0&&(this.remove.forEach(t=>{this.removeEntity(t)}),this.remove=[]))},this.view=t,this.entities=[],this.remove=[],this.delay=Math.round(1e3/l.fps),this.counter=0,this.entityCount=0,this.paused=!1,g.subscribe(p.PAUSE_APP,this.pause),g.subscribe(p.RESUME_APP,this.resume),g.subscribe(p.SET_FPS,this.onSetFPS),g.subscribe(p.ADD_ENTITY,this.addEntity),g.subscribe(p.REMOVE_ENTITY,this.removeEntity),g.subscribe(p.REMOVE_TYPE,this.removeType),g.subscribe(p.COLLISION,this.onCollision)}}var u=s(73875),m={DEFAULT:"default",WALL:"wall",PLAYER:"player",PARTICLE:"particle",ENEMY:"enemy",SUICA:"suica"};let w={};var x={down:t=>{w[t]=!0},up:t=>{w[t]=!1},key:t=>w[t]},v={addEntity:t=>{g.dispatch(p.ADD_ENTITY,t)},removeEntity:t=>{g.dispatch(p.REMOVE_ENTITY,t)},removeType:t=>{g.dispatch(p.REMOVE_TYPE,t)},setState:t=>{g.dispatch(p.SET_STATE,t)},setScale:t=>{a.scale=t,a.width=a.windowWidth/a.scale,a.height=a.windowHeight/a.scale,g.dispatch(p.SET_SCALE,t)},setFPS:t=>{l.fps=t,g.dispatch(p.SET_FPS,t)},setLayerVisibility:(t,i)=>{i?g.dispatch(p.SHOW_LAYER,t):g.dispatch(p.HIDE_LAYER,t)},showOverlay:t=>{g.dispatch(p.SHOW_OVERLAY,t)},hideOverlay:()=>{g.dispatch(p.HIDE_OVERLAY)},keyDown:t=>{x.down(t),g.dispatch(p.KEY_DOWN,t)},keyUp:t=>{x.up(t),g.dispatch(p.KEY_UP,t)},enableKeys:t=>{g.dispatch(p.ENABLE_KEYS,t)},disableKeys:()=>{g.dispatch(p.DISABLE_KEYS)},createBody:(t,i,s,e)=>{g.dispatch(p.CREATE_BODY,{entity:t,shape:i,bodyDef:s,fixDef:e})},destroyBody:t=>{g.dispatch(p.DESTROY_BODY,t)}};class E extends o(){constructor(){super(),this.init=()=>{},this.mouseDown=t=>{this.onMouseDownCallback=t},this.update=()=>{},this.addBody=t=>{this.body=t;let i=u.Vec2(this.x,this.y);this.body.setPosition(i)},this.removeBody=()=>{this.body&&v.destroyBody(this.body)},this.pos=()=>({x:this.x,y:this.y}),this.handleCollision=()=>{},this.dispose=()=>{},this.id=0,this.layer=0,this.type=m.DEFAULT,this.view=!1,this.render=!1,this.remove=!1,this.addEventListener(MouseEvent.MOUSE_DOWN,()=>{this.onMouseDownCallback&&this.onMouseDownCallback(this)})}}var T=E;class b extends T{getBodyAtMouse(){this.mousePVec=new u.B2Vec2(this.stage.mouseX,this.stage.mouseY);let t=new u.AABB;t.lowerBound.Set(this.mousePVec.x-.001,this.mousePVec.y-.001),t.upperBound.Set(this.mousePVec.x+.001,this.mousePVec.y+.001),this.world.queryAABB(this.getBodyCB,t)}getBodyCB(t){return!(t.GetBody().GetType()!==u.B2Body.b2_staticBody&&t.GetShape().TestPoint(t.GetBody().GetTransform(),this.mousePVec))}constructor(){super(),this.createBody=t=>{let{entity:i,shape:s,bodyDef:e,fixDef:h}=t,n=this.world.createBody(e);n.createFixture(s,h),n.setMassData({mass:10,center:(0,u.Vec2)(0,0),I:1}),i.addBody(n)},this.destroyBody=t=>{this.world.destroyBody(t)},this.update=()=>{this.world.step(1/l.worldStep)},this.world=u.World({gravity:new u.Vec2(0,50),continuousPhysics:!0}),this.world.on("post-solve",t=>{let i=t.getFixtureA(),s=i.getBody(),e=i.getUserData(),h=t.getFixtureB(),n=h.getBody(),a=h.getUserData();g.dispatch(p.COLLISION,{uA:e,uB:a,bA:s,bB:n})}),g.subscribe(p.CREATE_BODY,this.createBody),g.subscribe(p.DESTROY_BODY,this.destroyBody)}}var S=s(15137),L=s.n(S);class f extends T{constructor(t=null,i=null,s=null){var e;super(),e=this,this.onMouseMove=t=>{this.setMousePos(t.stageX,t.stageY)},this.onMouseDown=t=>{this.setMousePos(t.stageX,t.stageY),this.mouseDown=!0},this.onMouseUp=t=>{this.mouseDown=!1},this.onMouseLeave=t=>{this.mouseDown=!1},this.setMousePos=(t,i)=>{this.xMouse=t/a.scale,this.yMouse=i/a.scale},this.setBackground=t=>{this.background.addChild(t)},this.add=t=>{this.content.addChild(t),this.items.push(t),this.autoCenter&&this.centerContent()},this.fill=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.width,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.height;e.background.graphics.beginFill(t),e.background.graphics.drawRect(0,0,i,s),e.background.graphics.endFill()},this.sort=()=>{for(let t of this.items.sort((t,i)=>t.y>i.y?1:t.y<i.y?-1:0))this.content.addChild(t)},this.center=()=>{this.x=a.width/2-this.width/2,this.y=a.height/2-this.height/2},this.centerBackground=()=>{this.background.x=a.width/2-this.background.width/2,this.background.y=a.height/2-this.background.height/2},this.centerContent=()=>{this.content.x=a.width/2-this.content.width/2,this.content.y=a.height/2-this.content.height/2},this.removeAll=()=>{for(let t of this.items)v.removeEntity(t),this.content.removeChild(t);this.items=[]},this.dispose=()=>{this.removeAll()},this.xMouse=0,this.yMouse=0,this.mouseDown=!1,this.items=[],this.view=!0,this.autoCenter=!1,this.background=new(o()),this.content=new(o()),this.addChild(this.background),this.addChild(this.content),this.addEventListener(L().MOUSE_MOVE,this.onMouseMove),this.addEventListener(L().MOUSE_DOWN,i=>{this.onMouseDown(i),t&&t(i)}),this.addEventListener(L().MOUSE_UP,this.onMouseUp),this.addEventListener(L().MOUSE_LEAVE,this.onMouseLeave)}}class M extends T{constructor(t,i=0,s=0){super(),this.getArgb=(t,i)=>0+(i<<24)+t,this.draw=()=>{let t;t=16777215+(2.55*(parseInt((this.bitmap.getPixel(this.x,this.y)>>24&255).toString(16))+3)<<24),this.bitmap.setPixel(this.x,this.y,t)},this.update=t=>{let i=3*Math.random();i<1?this.x-=1:i>2&&(this.x+=1),this.x<0&&(this.x=0),this.x>this.bitmap.width&&(this.x=this.bitmap.width);let s=3*Math.random();s<1?this.y-=1:s>2&&(this.y+=1),this.y<0&&(this.y=0),this.y>this.bitmap.height&&(this.y=this.bitmap.height),this.draw()},this.bitmap=t,this.x=i,this.y=s}}class C{constructor(t,i){this.update=()=>{this.time+=1,this.time%this.delay==0&&this.callback()},this.delay=t,this.callback=i,this.time=Math.floor(100*Math.random())}}let O={HORIZONTAL:"horizontal",VERTICAL:"vertical"};class A extends o(){constructor(){super(),this.add=t=>{this.items.push(t),this.addChild(t),this.align()},this.horizontal=()=>{this.alignment=O.HORIZONTAL},this.vertical=()=>{this.alignment=O.VERTICAL},this.align=()=>{if(this.alignment===O.HORIZONTAL){let t=0;this.items.forEach(i=>{i.x=t,t+=i.width+this.spacing})}else if(this.alignment===O.VERTICAL){let t=0;this.items.forEach(i=>{i.y=t,t+=i.height+this.spacing})}},this.setWidth=t=>{this.items.forEach(i=>{i.setWidth(t)})},this.next=()=>{this.deselect(),this.selectedIndex+=1,this.selectedIndex>=this.items.length&&(this.selectedIndex=0),this.select(this.selectedIndex)},this.previous=()=>{this.deselect(),this.selectedIndex-=1,this.selectedIndex<0&&(this.selectedIndex=this.items.length-1),this.select(this.selectedIndex)},this.deselect=()=>{this.selected&&(this.selected.hideHighlight(),this.selected=null)},this.select=t=>{this.selectedIndex=t,this.selected=this.items[t],this.selected.showHighlight()},this.items=[],this.alignment=O.HORIZONTAL,this.spacing=0,this.selected=null,this.selectedIndex=-1}}var D=s(88117),P=s.n(D),I=s(34691),_=s(19349),k=s(21926),B=s.n(k),Y={F:"04b03",ATTRACT:"Attract"};class N extends o(){constructor(t,i=Y.F,s=10,e=16777215){super(),this.setText=t=>{this.text=t,this.textField.text=t},this.setFont=t=>{this.font=t,this.update()},this.setSize=t=>{this.size=t,this.update()},this.update=()=>{this.textField.defaultTextFormat=new(B())(this.font,this.size,this.color),this.textField.text=this.text},this.text=t,this.font=i,this.size=s,this.color=e;let h=new(B())(i,s,e);this.textField=new(P()),this.textField.defaultTextFormat=h,this.textField.embedFonts=!0,this.textField.selectable=!1,this.textField.antiAliasType=I.ZP.ADVANCED,this.textField.autoSize=_.ZP.LEFT,this.textField.text=t,this.addChild(this.textField)}}class R extends o(){constructor(){super();let t=new(B())(Y.F,30,16777215);this.textField=new(P()),this.textField.defaultTextFormat=t,this.textField.embedFonts=!0,this.textField.selectable=!0,this.textField.antiAliasType=I.ZP.ADVANCED,this.addChild(this.textField)}}var U=s(56018),F=s.n(U),W=s(95727),K=s.n(W);class V extends o(){constructor(t){if(super(),this.center=()=>{this.bitmap.x=-this.bitmap.width/2,this.bitmap.y=-this.bitmap.height/2},!t)return;this.bitmapData=F().getBitmapData("assets/".concat(t)),this.bitmap=new(K())(this.bitmapData),this.bitmap.smoothing=!1,this.addChild(this.bitmap)}}var X=s(39073),H=s.n(X),z=s(44680),G=s.n(z),Z=s(8060);class q extends o(){constructor(t,i,s,e=10){super(),this.setIndexX=t=>{this.indexX=t,this.render()},this.setIndexY=t=>{this.indexY=t,this.render()},this.render=()=>{let t=new(H())(1,0,0,1,-this.w*this.indexX,-this.h*this.indexY);this.bmd1.fillRect(this.bmd1.rect,0),this.bmd1.draw(this.bmd,t)},this.play=()=>{this.playing=!0,this.interval=setInterval(()=>{this.indexY+=1,this.indexY===this.framesY&&(this.indexY=0),this.render()},this.delay)},this.stepX=()=>{this.indexX+=1,this.indexX===this.framesX&&(this.indexX=0),this.render()},this.playX=()=>{this.playing=!0,this.interval=setInterval(this.stepX,this.delay)},this.stop=()=>{this.playing=!1,this.indexY=1,this.indexX=1,this.render(),this.interval&&clearInterval(this.interval)},this.delay=e,this.bmd=F().getBitmapData("assets/".concat(t)),this.framesX=i,this.framesY=s,this.indexX=0,this.indexY=0,this.playing=!1,this.w=Math.round(this.bmd.width/this.framesX),this.h=Math.round(this.bmd.height/this.framesY),this.bmd1=new(G())(this.w,this.h,!0,0),this.bm=new(K())(this.bmd1,Z.ZP.AUTO,!1),this.addChild(this.bm),this.render()}}var j=s(47660),J=s.n(j);class Q extends o(){constructor(t,i){var s;super(),s=this,this.data=()=>this.bmd,this.draw=t=>{this.bmd.draw(t,new(H())(1,0,0,1,t.x,t.y))},this.getPixel=(t,i)=>this.bmd.getPixel32(t,i),this.setPixel=function(t,i){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215;s.bmd.setPixel32(t,i,e)},this.rect=(t,i,s,e,h)=>{let n=new(J())(t,i,s,e);this.bmd.fillRect(n,h)},this.clear=()=>{this.bmd.fillRect(new(J())(0,0,this.bm.width,this.bm.height),0)},this.bmd=new(G())(t,i,!0,0),this.bm=new(K())(this.bmd,Z.ZP.NEVER,!1),this.addChild(this.bm)}}var $=s(33292),tt=s.n($);let ti=Math.sqrt(5),ts=(ti+1)/2,te=2/3*45,th=(t,i)=>Math.atan2(i.y-t.y,i.x-t.x),tn=(t,i)=>({x:t*te+i*te,y:i*te/2-t*te/2}),ta=t=>th({x:t.x*a.scale,y:t.y*a.scale},{x:a.mouseX,y:a.mouseY});var td={fib:t=>(Math.pow(ts,t)-Math.pow(-1,t))/ti,phi:ts,angle:ta,radians:th,hexSize:45,hexOneThird:1/3*45,hexTwoThird:te,iso:tn,depth:t=>tn(t).y,angle:ta,a:(t,i)=>Math.atan2(i.y-t.y,i.x-t.x)/Math.PI*360,distance:(t,i)=>{let s=t.x-i.x,e=t.y-i.y;return Math.sqrt(s*s+e*e)}};class to extends o(){constructor(t=1,i=16777215,s=1){var e;super(),e=this,this.onMouseDown=t=>{this.addEventListener(L().MOUSE_DOWN,()=>{t(this)})},this.onRollOver=t=>{this.addEventListener(L().ROLL_OVER,()=>{t(this)})},this.onRollOut=t=>{this.addEventListener(L().ROLL_OUT,()=>{t(this)})},this.add=t=>{this.content=t,this.content.mask=this.s,t.width=this.s.width,t.height=this.s.height,t.x-=t.width/2,this.addChild(this.content)},this.dot=()=>{this.s.graphics.moveTo(0,0),this.s.graphics.lineTo(0,0)},this.hexagon=()=>{this.s.graphics.beginFill(16777215,.3);let t=0,i=0;this.s.graphics.moveTo(t,i),t+=td.hexTwoThird,i+=td.hexOneThird,this.s.graphics.lineTo(t,i),i+=td.hexTwoThird,this.s.graphics.lineTo(t,i),t-=td.hexTwoThird,i+=td.hexOneThird,this.s.graphics.lineTo(t,i),t-=td.hexTwoThird,i-=td.hexOneThird,this.s.graphics.lineTo(t,i),i-=td.hexTwoThird,this.s.graphics.lineTo(t,i),t+=td.hexTwoThird,i-=td.hexOneThird,this.s.graphics.lineTo(t,i),this.s.graphics.endFill()},this.cube=t=>{let i=1/3*t,s=2/3*t,e=0,h=0;this.s.graphics.moveTo(e,h),e+=s,h+=i,this.s.graphics.lineTo(e,h),h+=s,this.s.graphics.lineTo(e,h),e-=s,h+=i,this.s.graphics.lineTo(e,h),e-=s,h-=i,this.s.graphics.lineTo(e,h),h-=s,this.s.graphics.lineTo(e,h),e+=s,h-=i,this.s.graphics.lineTo(e,h)},this.tile=t=>{this.s.graphics.lineStyle(1,16777215,0),this.s.graphics.beginFill(16777215,0);let i=1/3*t,s=2/3*t,e=0,h=0;this.s.graphics.moveTo(e,h),e+=s,h+=i,this.s.graphics.lineTo(e,h),e-=s,h+=i,this.s.graphics.lineTo(e,h),e-=s,h-=i,this.s.graphics.lineTo(e,h),e+=s,h-=i,this.s.graphics.lineTo(e,h),this.s.graphics.endFill()},this.addLines=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16777215,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e.lines=new(tt()),e.lines.graphics.lineStyle(t,i,s),e.addChild(e.lines);let h=0,n=0;e.lines.graphics.moveTo(h,n),h+=td.hexTwoThird,n+=td.hexOneThird,e.lines.graphics.lineTo(h,n),n+=td.hexTwoThird,e.lines.graphics.lineTo(h,n),h-=td.hexTwoThird,n+=td.hexOneThird,e.lines.graphics.lineTo(h,n),h-=td.hexTwoThird,n-=td.hexOneThird,e.lines.graphics.lineTo(h,n),n-=td.hexTwoThird,e.lines.graphics.lineTo(h,n),h+=td.hexTwoThird,n-=td.hexOneThird,e.lines.graphics.lineTo(h,n)},this.addShadow=()=>{this.shadow=new(tt()),this.shadow.graphics.lineStyle(0,0,0),this.addChild(this.shadow);let t=0,i=td.hexTwoThird;this.shadow.graphics.beginFill(0,.5),this.shadow.graphics.moveTo(t,i),t+=td.hexTwoThird,i-=td.hexOneThird,this.shadow.graphics.lineTo(t,i),i+=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),t-=td.hexTwoThird,i+=td.hexOneThird,this.shadow.graphics.lineTo(t,i),i-=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),this.shadow.graphics.endFill(),t=0,i=td.hexTwoThird,this.shadow.graphics.beginFill(0,.8),this.shadow.graphics.moveTo(t,i),i+=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),t-=td.hexTwoThird,i-=td.hexOneThird,this.shadow.graphics.lineTo(t,i),i-=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),t+=td.hexTwoThird,i+=td.hexOneThird,this.shadow.graphics.lineTo(t,i),this.shadow.graphics.endFill()},this.addInverseShadow=()=>{this.shadow=new(tt()),this.shadow.graphics.lineStyle(0,0,0),this.addChild(this.shadow);let t=-td.hexTwoThird,i=td.hexOneThird;this.shadow.graphics.beginFill(0,.5),this.shadow.graphics.moveTo(t,i),t+=td.hexTwoThird,i-=td.hexOneThird,this.shadow.graphics.lineTo(t,i),i+=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),t-=td.hexTwoThird,i+=td.hexOneThird,this.shadow.graphics.lineTo(t,i),i-=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),this.shadow.graphics.endFill(),t=0,i=0,this.shadow.graphics.beginFill(0,.8),this.shadow.graphics.moveTo(t,i),t+=td.hexTwoThird,i+=td.hexOneThird,this.shadow.graphics.lineTo(t,i),i+=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),t-=td.hexTwoThird,i-=td.hexOneThird,this.shadow.graphics.lineTo(t,i),i-=td.hexTwoThird,this.shadow.graphics.lineTo(t,i),this.shadow.graphics.endFill()},this.circle=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n.GradientType.RADIAL,new n.Matrix,e.s.graphics.lineStyle(0,e.color,0),e.s.graphics.beginFill(i,1),e.s.graphics.drawCircle(0,0,t),e.s.graphics.endFill()},this.glow=()=>{let t=new n.GlowFilter(16777215,1,6,6,6,1,!1,!1);this.s.filters=[t]},this.rectangle=(t,i)=>{this.s.graphics.lineStyle(1,this.color,0),this.s.graphics.beginFill(this.color,this.alpha),this.s.graphics.moveTo(0,0),this.s.graphics.lineTo(t,0),this.s.graphics.lineTo(t,i),this.s.graphics.lineTo(0,i),this.s.graphics.lineTo(0,0),this.s.graphics.endFill()},this.color=i,this.alpha=s,this.s=new(tt()),this.s.graphics.lineStyle(t,i,s),this.addChild(this.s)}}var tl=s(46335),tr=s.n(tl),tc=s(46404),tg=s.n(tc);class tp extends o(){constructor(t,i,s,e,h){super(),this.add=t=>{this.tilemap.addTile(t),this.tiles.push(t)},this.clear=()=>{this.tiles.forEach(t=>{this.tilemap.removeTile(t)}),this.tiles=[]},this.getTileAt=t=>this.tilemap.getTileAt(t),this.tiles=[],this.tileset=new(tg())(t),this.tileWidth=Math.round(t.width/i),this.tileHeight=Math.round(t.height/s);for(let t=0;t<i;t+=1)for(let i=0;i<s;i+=1)this.tileset.addRect(new(J())(t*this.tileWidth,i*this.tileHeight,this.tileWidth,this.tileHeight));this.tilemap=new(tr())(e,h,this.tileset),this.tilemap.tileAlphaEnabled=!1,this.tilemap.tileColorTransformEnabled=!1,this.addChild(this.tilemap)}}var ty=s(52287),tu=s.n(ty);class tm extends tu(){}class tw{constructor(t,i,s){this.type=t,this.init=i,this.dispose=s}}class tx{constructor(){this.add=(t,i,s)=>{let e=new tw(t,i,s);this.states.push(e)},this.set=t=>{if(this.stateType===t)return;this.state&&(this.state.dispose(),this.state=null,this.stateType="");let i=this.states.find(i=>i.type===t);i&&(this.stateType=t,this.state=i,this.state.init())},this.reload=()=>{let t=this.stateType;this.state&&(this.state.dispose(),this.state=null,this.stateType=""),this.set(t)},this.dispose=()=>{this.state&&(this.state.dispose(),this.state=null,this.stateType="")},this.states=[],this.stateType="",this.state=null}}class tv extends o(){constructor(t=()=>{}){super(),this.onMouseMove=()=>{if(this.moveX){let t=this.stage.mouseX/a.scale-this.width/2-this.offsetX;this.maxX&&t>this.maxX&&(t=this.maxX),t<0&&(t=0),this.x=t}this.moveY&&(this.y=this.stage.mouseY/a.scale-this.height/2),this.callback()},this.onMouseDown=()=>{this.isDragging=!0,this.stage.addEventListener(L().MOUSE_UP,this.onMouseUp),this.stage.addEventListener(L().MOUSE_MOVE,this.onMouseMove),this.stage.addEventListener(L().MOUSE_LEAVE,this.onMouseUp)},this.onMouseUp=()=>{this.isDragging=!1,this.stage.removeEventListener(L().MOUSE_UP,this.onMouseUp),this.stage.removeEventListener(L().MOUSE_MOVE,this.onMouseMove),this.stage.removeEventListener(L().MOUSE_LEAVE,this.onMouseUp)},this.isDragging=!1,this.moveX=!0,this.moveY=!0,this.maxX=0,this.maxY=0,this.offsetX=0,this.offsetY=0,this.callback=t,this.addEventListener(L().MOUSE_DOWN,this.onMouseDown)}}class tE extends o(){constructor(){super(),this.add=t=>{this.sm.add(this.content.length,()=>{this.current=this.content[this.index],this.addChild(this.current)},()=>{this.removeChild(this.current),this.current=null}),this.content.push(t),this.current||this.sm.set(this.index)},this.next=()=>{this.index+=1,this.index>=this.content.length&&(this.index=0),this.sm.set(this.index)},this.prev=()=>{this.index-=1,this.index<0&&(this.index=this.content.length-1),this.sm.set(this.index)},this.content=[],this.index=0,this.current=null,this.sm=new tx}}class tT extends o(){constructor(t="grid/default.png"){let i;super(),this.setSize=(t,i)=>{this.images[1].x=this.images[0].width,this.images[1].width=t-2*this.images[0].width,this.images[2].x=this.images[1].x+this.images[1].width,this.images[3].height=i-2*this.images[0].height,this.images[3].y=this.images[0].height,this.images[4].x=this.images[0].width,this.images[4].y=this.images[0].height,this.images[4].width=t-2*this.images[0].width,this.images[4].height=i-2*this.images[0].height,this.images[5].height=i-2*this.images[0].height,this.images[5].y=this.images[0].height,this.images[5].x=this.images[2].x,this.images[6].y=this.images[3].y+this.images[3].height,this.images[7].width=this.images[1].width,this.images[7].y=this.images[6].y,this.images[7].x=this.images[0].width,this.images[8].y=this.images[7].y,this.images[8].x=this.images[7].x+this.images[7].width},this.path=t,this.images=[];for(let s=0;s<3;s+=1)for(let e=0;e<3;e+=1)(i=new q(t,3,3)).setIndexX(e),i.setIndexY(s),this.addChild(i),this.images.push(i)}}class tb extends o(){constructor(t,i=()=>{}){super(),this.add=t=>{this.content.addChild(t),this.bg.setSize(this.content.width,this.content.height),this.highlight.setSize(this.content.width,this.content.height)},this.addText=t=>{let i=new N(t,Y.F,10);i.x=3,i.y=1,this.content.addChild(i),this.bg.setSize(this.content.width+8,this.content.height),this.highlight.setSize(this.content.width+8,this.content.height)},this.setWidth=t=>{this.highlight.setSize(t,this.content.height),this.bg.setSize(t,this.content.height)},this.showHighlight=()=>{this.highlight.visible=!0},this.hideHighlight=()=>{this.highlight.visible=!1},this.callback=i,this.bg=new tT(t),this.addChild(this.bg),this.highlight=new tT("grid/btnHighlight.png"),this.addChild(this.highlight),this.highlight.visible=!1,this.content=new(o()),this.addChild(this.content),this.addEventListener(L().MOUSE_DOWN,()=>{i()}),this.addEventListener(L().ROLL_OVER,()=>{this.showHighlight()}),this.addEventListener(L().ROLL_OUT,()=>{this.hideHighlight()}),this.mouseChildren=!1}}class tS extends o(){constructor(t="grid/modal.png"){super(),this.add=t=>{this.container.add(t),this.grid.setSize(this.container.content.width+this.padding,this.container.content.height+this.padding),this.container.centerContent(),this.container.centerBackground()},this.dispose=()=>{v.removeEntity(this.container)},this.padding=0,this.container=new f,this.container.layer="modal",v.addEntity(this.container),this.grid=new tT(t),this.container.setBackground(this.grid)}}class tL extends o(){constructor(t){super(),this.init=t=>{this.drag.offsetX=this.x,this.drag.x=t},this.border=new tT("grid/dark.png"),this.border.setSize(110,10),this.addChild(this.border),this.drag=new tv(()=>{t(this.drag.x),this.text.setText(this.drag.x.toString())}),this.drag.moveY=!1,this.drag.maxX=100;let i=new V("handle.png");this.drag.addChild(i),this.addChild(this.drag),this.text=new N("50",Y.F,10,15658734),this.addChild(this.text),this.text.x=110,this.text.y-=2}}var tf=s(90393),tM=s.n(tf);class tC extends o(){constructor(t="label"){super(),this.add=t=>{this.menu.add(t),this.updateSize()},this.addButton=(t,i)=>{let s=new tb("transparent.png",()=>{i(),v.showOverlay(this.content),v.enableKeys(this)});s.addText(t),this.add(s)},this.updateSize=()=>{let t=this.content.width>this.btn.width?this.content.width:this.btn.width,{height:i}=this.menu;this.bg.setSize(t,i),this.menu.setWidth(t)},this.enableKeyNavigation=()=>{this.keySubscription=g.subscribe(p.KEY_DOWN,t=>{this.keyDown(t)})},this.disableKeyNavigation=()=>{g.remove(this.keySubscription)},this.keyDown=t=>{switch(t){case 38:v.showOverlay(this.content),v.enableKeys(this),this.menu.previous(),this.menu.selected.callback();break;case 40:v.showOverlay(this.content),v.enableKeys(this),this.menu.next(),this.menu.selected.callback();break;default:v.showOverlay(this.content),v.enableKeys(this)}},this.btn=new tb("grid/dropdown.png",()=>{let t=this.localToGlobal(new(tM())(0,0));this.content.x=t.x/a.scale,this.content.y=t.y/a.scale+this.btn.height,v.showOverlay(this.content),v.enableKeys(this)}),this.btn.addText(t),this.addChild(this.btn),this.content=new(o()),this.bg=new tT("grid/dark.png"),this.content.addChild(this.bg),this.menu=new A,this.menu.vertical(),this.content.addChild(this.menu),this.caret=new q("caret.png",2,1),this.caret.x=this.btn.width-4,this.caret.y=6,this.btn.add(this.caret),this.btn.setWidth(this.btn.width+4),this.btn.addEventListener(L().ROLL_OVER,()=>{this.caret.setIndexX(1)}),this.btn.addEventListener(L().ROLL_OUT,()=>{this.caret.setIndexX(0)})}}var tO={toggle:()=>new tE,tower:()=>{let t=new Tower;return v.addEntity(t),t},container:(t,i)=>{let s=new f(t);return i&&(s.layer=i),v.addEntity(s),s},textButton:(t,i,s)=>{let e=new tb(s,i);return e.addText(t),e},imageButton:(t,i,s)=>{let e=new tb(s,i),h=new V(t);return e.add(h),e},menu:()=>new A,image:t=>new V(t),text:(t,i,s,e)=>new N(t,i,s,e),input:(t,i,s,e)=>new R(t,i,s,e),animation:(t,i)=>{let s=new Animation(t,i);return v.addEntity(s),s},spritesheet:(t,i,s,e)=>new q(t,i,s,e),bitmap:(t,i)=>new Q(t,i),shape:(t,i,s)=>new to(t,i,s),tile:t=>new tm(t),interval:(t,i)=>new C(t,i),box:(t,i)=>{let s=new Box(t,i);return v.addEntity(s),s},draw:(t,i,s)=>{let e=new M(t,i,s);return v.addEntity(e),e},tilemap:(t,i,s,e,h)=>new tp(t,i,s,e,h),stateMachine:()=>new tx,grid:t=>new tT(t),modal:t=>new tS(t),drag:t=>new tv(t),steps:t=>new tL(t),dropdown:t=>new tC(t),body:function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"dynamic",h=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return{bullet:t,linearDamping:i,angularDamping:s,type:e,allowSleep:h}},fixture:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return{friction:t,restitution:i,density:s,userData:{id:e},filter:{maskBits:h,categoryBits:n},isSensor:a}},planckBox:(t,i)=>u.Box(t,i),planckCircle:t=>u.Circle(t)};class tA extends o(){constructor(){super(),this.subscribeToMessages=()=>{g.subscribe(p.SHOW_LAYER,this.showLayer),g.subscribe(p.HIDE_LAYER,this.hideLayer),g.subscribe(p.SET_SCALE,this.setScale)},this.showLayer=t=>{let i=this.layers[t];i&&(i.visible=!0)},this.hideLayer=t=>{let i=this.layers[t];i&&(i.visible=!1)},this.setScale=()=>{this.scaleX=a.scale,this.scaleY=a.scale},this.getLayer=t=>{var i;return null!==(i=this.layers[t])&&void 0!==i?i:this.addLayer(t)},this.addLayer=t=>{let i=new(o());return this.layers[t]=i,this.content.addChild(i),this.sort(),i},this.render=t=>{this.bm.draw(t)},this.add=t=>{this.getLayer(t.layer).addChild(t)},this.remove=t=>{this.getLayer(t.layer).removeChild(t)},this.setMousePos=(t,i)=>{a.mouseX=t,a.mouseY=i},this.onMouseMove=t=>{this.setMousePos(t.stageX,t.stageY)},this.onMouseDown=t=>{this.setMousePos(t.stageX,t.stageY),this.setMousePos(t.stageX,t.stageY),a.mouseDown=!0},this.onMouseUp=()=>{a.mouseDown=!1},this.onMouseLeave=()=>{a.mouseDown=!1},this.fill=t=>{this.background.graphics.beginFill(t),this.background.graphics.drawRect(0,0,a.width,a.height),this.background.graphics.endFill()},this.clear=()=>{this.bm.clear()},this.sort=()=>{let t=[];for(let i in this.layers)t.push(this.layers[i]);for(let i of t.sort((t,i)=>t.layer>i.layer?1:t.layer<i.layer?-1:0))this.content.addChild(i)},this.background=new(o()),this.addChild(this.background),this.content=new(o()),this.addChild(this.content),this.bm=tO.bitmap(a.width,a.height),this.addChild(this.bm),new n.GlowFilter(11674146,1,5,5,5,1,!0,!1),this.layers={},this.addEventListener(L().MOUSE_MOVE,this.onMouseMove),this.addEventListener(L().MOUSE_DOWN,this.onMouseDown),this.addEventListener(L().MOUSE_UP,this.onMouseUp),this.addEventListener(L().MOUSE_LEAVE,this.onMouseLeave),this.subscribeToMessages(),this.setScale(a.scale)}}class tD extends o(){constructor(){super(),this.show=t=>{if(this.content&&(this.removeChild(this.content),this.content===t)){this.content=null;return}this.content=t,this.addChild(this.content)},this.hide=()=>{this.content&&(this.removeChild(this.content),this.content=null)},this.setScale=t=>{this.scaleX=t,this.scaleY=t},this.content=null,this.setScale(a.scale),g.subscribe(p.SHOW_OVERLAY,this.show),g.subscribe(p.HIDE_OVERLAY,this.hide),g.subscribe(p.SET_SCALE,this.setScale)}}var tP={FIBONACCI:"fibonacci",DRAW:"draw",COLLISION:"collision",Suica:"suica"};class tI extends T{constructor(){super(),this.init=()=>{}}}var t_=tI;class tk extends T{constructor(t,i){super(),this.clamp=(t,i,s)=>Math.min(Math.max(t,i),s),this.update=()=>{let t=this.x-a.mouseX/a.scale,i=this.y-a.mouseY/a.scale,s=Math.sqrt(t*t+i*i),e={x:t/s,y:i/s},h=this.clamp(1/this.repulseRadius*(-1*(s/this.repulseRadius)**2+1)*this.repulseRadius*this.velocity,0,50);this.x+=e.x*h,this.y+=e.y*h;let n=this.orig.x-this.x,d=this.orig.y-this.y,o=Math.sqrt(n*n+d*d);if(0===o)return;if(o<1){this.x=this.orig.x,this.y=this.orig.y;return}let l={x:n/o*1.5,y:d/o*1.5};this.x+=l.x,this.y+=l.y,this.img.rotation=180*Math.atan((this.y-a.height/2)/(this.x-a.width/2))/Math.PI};let s=tO.image("leaf/leaf.png"),e=360-360/td.phi,h=Math.sqrt(t),n=e*t/(180/Math.PI),d={x:9*h*Math.cos(n)+a.width/2,y:9*h*Math.sin(n)+a.height/2};s.rotation=n/Math.PI*180,s.alpha=0,s.center(),this.repulseRadius=500,this.velocity=1.6,this.img=s,this.addChild(s),this.orig=d,this.x=d.x+50*Math.cos(n),this.y=d.y+50*Math.sin(n)}}let tB={0:4021145,1:11674146,2:15555914,3:7600831,4:5013398,5:4890056,bg:0};class tY extends t_{constructor(){super(),this.setTheme=t=>{this.theme=t;let i=this.theme.bg;this.container.fill(i),this.clear(),this.addLeaves()},this.clear=()=>{this.leaves.forEach(t=>{t.parent.removeChild(t)}),this.leaves=[],this.origs=[],clearInterval(this.interval)},this.addLeaves=()=>{let t;this.interval=setInterval(()=>{let i=new tk(t=this.leaves.length+1,this.getColor(t));this.leaves.push(i),v.addEntity(i),this.container.add(i),t>500&&clearInterval(this.interval)},10)},this.getColor=t=>t%12==0?this.theme["5"]:t%10==0?this.theme["4"]:t%8==0?this.theme["3"]:t%5==0?this.theme["2"]:t%3==0?this.theme["1"]:this.theme["0"],this.update=()=>{this.leaves.forEach(t=>{t.update()})},this.dispose=()=>{this.clear(),v.removeEntity(this.container),v.removeEntity(this.menu)},this.leaves=[],this.origs=[],this.container=tO.container(),this.menu=tO.menu(),this.container.add(this.menu),this.menu.y=30,this.setTheme(tB),this.menu.y=a.height-this.menu.height,this.container.center()}}class tN extends t_{constructor(){super(),this.dispose=()=>{v.removeEntity(this.container)},this.w=150,this.h=150,this.container=tO.container(),this.bm=tO.bitmap(this.w,this.h),this.bm.x=20,this.bm.y=20,this.container.add(this.bm),this.draw1=tO.draw(this.bm,70,70),this.draw2=tO.draw(this.bm,70,70),this.draw3=tO.draw(this.bm,70,70),this.draw4=tO.draw(this.bm,70,70)}}var tR={NONE:"none",LEFT:0,LEFT_UP:1,UP:2,UP_RIGHT:3,RIGHT:4,RIGHT_DOWN:5,DOWN:6,DOWN_LEFT:7};class tU{constructor(t){this.keys=()=>{g.subscribe(p.KEY_DOWN,this.onKeyDown),g.subscribe(p.KEY_UP,this.onKeyUp)},this.onKeyDown=t=>{this.isWalkingKey(t)&&(this.updateDirection(),this.updateSpeed()),this.isShootinggKey(t)&&(this.model.isShooting=!0)},this.onKeyUp=t=>{this.isWalkingKey(t)&&(this.model.isWalking=this.isWalking(),this.model.isWalking?(this.updateDirection(),this.updateSpeed()):(this.model.setDirection(tR.NONE),this.model.setSpeed(0,0))),this.isShootinggKey(t)&&(this.model.isShooting=this.isShooting())},this.isShootinggKey=t=>this.model.shootingKeys.find(i=>i===t),this.isWalkingKey=t=>this.model.walkingKeys.find(i=>i===t),this.updateSpeed=()=>{let t=this.model.getDirection();if(t===tR.NONE){this.model.setSpeed(0,0);return}switch(t){case tR.LEFT:this.model.setSpeed(-this.model.speed,0);break;case tR.LEFT_UP:this.model.setSpeed(-this.model.speed/2,-this.model.speed/2);break;case tR.UP:this.model.setSpeed(0,-this.model.speed);break;case tR.UP_RIGHT:this.model.setSpeed(this.model.speed/2,-this.model.speed/2);break;case tR.RIGHT:this.model.setSpeed(this.model.speed,0);break;case tR.RIGHT_DOWN:this.model.setSpeed(this.model.speed/2,this.model.speed/2);break;case tR.DOWN:this.model.setSpeed(0,this.model.speed);break;case tR.DOWN_LEFT:this.model.setSpeed(-this.model.speed/2,this.model.speed/2)}},this.updateDirection=()=>{let t=this.getDirection();this.model.setDirection(t)},this.getDirection=()=>{let t=tR.NONE;return(x.key(38)||x.key(87))&&(t=tR.UP),(x.key(40)||x.key(83))&&(t=tR.DOWN),(x.key(37)||x.key(65))&&(t=t===tR.UP?tR.LEFT_UP:t===tR.DOWN?tR.DOWN_LEFT:tR.LEFT),(x.key(39)||x.key(68))&&(t=t===tR.UP?tR.UP_RIGHT:t===tR.DOWN?tR.RIGHT_DOWN:tR.RIGHT),t},this.getDirectionToPoint=(t,i)=>{let s=tR.NONE;return t.y>i.y&&(s=tR.UP),t.y<i.y&&(s=tR.DOWN),t.x>i.x&&(s=s===tR.UP?tR.LEFT_UP:s===tR.DOWN?tR.DOWN_LEFT:tR.LEFT),t.x<i.x&&(s=s===tR.UP?tR.UP_RIGHT:s===tR.DOWN?tR.RIGHT_DOWN:tR.RIGHT),s},this.setDirection=t=>{this.model.setDirection(t)},this.moveToPoint=(t,i)=>{let s=td.radians(t,i),e=this.model.speed*Math.cos(s),h=this.model.speed*Math.sin(s);this.model.setSpeed(e,h)},this.isWalking=()=>(this.model.walkingKeys.forEach(t=>x.key(t)),!1),this.isShooting=()=>(this.model.shootingKeys.forEach(t=>x.key(t)),!1),this.stop=()=>{this.model.setDirection(tR.NONE),this.model.setSpeed(0,0)},this.dispose=()=>{g.unsubscribe(p.KEY_DOWN,this.onKeyDown),g.unsubscribe(p.KEY_DOWN,this.onKeyDown)},this.model=t}}let tF=0,tW=0,tK=0,tV=0,tX=tR.NONE,tH=t=>{tX=t};var tz={xSpeed:tK,ySpeed:tV,speed:100,setSpeed:(t,i)=>{tK=t,tV=i},getSpeed:()=>({x:tK,y:tV}),isWalking:!1,walkingKeys:[37,38,39,40,65,68,83,87],isShooting:!1,shootingKeys:[32],resetDirection:()=>{tH(tR.NONE)},getDirection:()=>tX,setDirection:tH,getPosition:()=>({x:tF,y:tW}),setPosition:(t,i)=>{tF=t,tW=i}};class tG{constructor(){this.getSpeed=()=>({x:this.xSpeed,y:this.ySpeed}),this.setSpeed=(t,i)=>{this.xSpeed=t,this.ySpeed=i},this.resetDirection=()=>{this.setDirection(tR.NONE)},this.getDirection=()=>this.direction,this.setDirection=t=>{this.direction=t},this.speed=10,this.xSpeed=0,this.ySpeed=0,this.isWalking=!1,this.isShooting=!1,this.direction=tR.NONE,this.walkingKeys=[],this.shootingKeys=[]}}var tZ={IDLE:"idle",WALK:"walk"},tq={WALL:1,PLAYER:2,PARTICLE:3,ENEMY:4,SUICA:5};class tj extends T{constructor(){super(),this.init=()=>{let t=tO.body(!0,.2,2,"dynamic",!1),i=tO.fixture(0,0,0,this.id,tq.WALL|tq.ENEMY,tq.PARTICLE,!1),s=tO.planckCircle(this.width/2);v.createBody(this,s,t,i)},this.vel=(t,i)=>{this.velocity=u.Vec2(t*this.speed,i*this.speed)},this.addBody=t=>{this.body=t;let i=u.Vec2(this.x,this.y);this.body.setPosition(i),this.body.setLinearVelocity(this.velocity)},this.handleCollision=t=>{if(t&&!t.remove)switch(t.type){case m.ENEMY:break;case m.WALL:this.remove=!0}},this.update=t=>{this.interval.update(t);let i=this.body.getPosition();this.x=i.x,this.y=i.y,(this.x<0||this.y<0||this.x>a.width||this.y>a.height)&&(this.remove=!0)},this.dispose=()=>{v.destroyBody(this.body)},this.type=m.PARTICLE,this.speed=1e3,this.damage=10,this.view=!0,this.velocity=null,this.ss=new q("collision/projectile.png",2,1),this.ss.x-=this.ss.width/2,this.ss.y-=this.ss.height/2,this.addChild(this.ss),this.interval=tO.interval(10,()=>{this.ss.stepX()})}}class tJ extends T{constructor(t){super(),this.init=()=>{let t=tO.body(!0,1,1),i=tO.fixture(1,.99,1,this.id,tq.ENEMY|tq.WALL,tq.PLAYER),s=tO.planckCircle(this.width/2);v.createBody(this,s,t,i),this.CM.setPosition(this.x,this.y)},this.shoot=()=>{let t=new tj;t.x=this.x,t.y=this.y;let i=this.facing/8*Math.PI*2+Math.PI,s=3*Math.cos(i),e=3*Math.sin(i);t.x+=(this.width+10)*Math.cos(i)/2,t.y+=(this.height+10)*Math.sin(i)/2,t.rotation=this.facing/8*360-90,t.vel(s,e),v.addEntity(t)},this.update=t=>{let i=this.CM.getSpeed(),s=u.Vec2(i.x,i.y);this.body.setLinearVelocity(s);let e=this.body.getPosition();this.x=e.x,this.y=e.y,this.CM.setPosition(e.x,e.y);let h=this.CM.getDirection();this.CM.getDirection()!==tR.NONE?(this.facing=h,this.sm.set(tZ.WALK)):this.sm.set(tZ.IDLE),this.facing!==tR.NONE&&this.ss.setIndexX(this.facing),this.CM.isShooting&&this.shooting.update(t)},this.dispose=()=>{this.shooting&&v.removeEntity(this.shooting)},this.view=!0,this.facing=0,this.layer=3,this.type=m.PLAYER,this.CM=t,this.shooting=tO.interval(20,this.shoot),this.sm=tO.stateMachine(),this.sm.add(tZ.IDLE,()=>{this.ss=tO.spritesheet("tv/tv_idle.png",8,1,150),this.ss.setIndexX(this.facing),this.addChild(this.ss),this.ss.x-=this.ss.width/2,this.ss.y-=this.ss.height/2},()=>{this.removeChild(this.ss)}),this.sm.add(tZ.WALK,()=>{this.ss=tO.spritesheet("tv/tv_walk.png",8,4,150),this.ss.setIndexX(this.facing),this.addChild(this.ss),this.ss.x-=this.ss.width/2,this.ss.y-=this.ss.height/2,this.ss.play()},()=>{this.removeChild(this.ss)}),this.sm.set(tZ.IDLE)}}class tQ extends T{constructor(t){super(),this.update=()=>{this.y-=1,this.time+=1,this.time>20&&v.removeEntity(this)},this.time=0,this.view=!0;let i=tO.text(t.toString(),Y.ATTRACT,14,0);this.addChild(i)}}class t$ extends T{constructor(t="target.png",i,s){super(),this.init=()=>{let t=tO.body(!0,1,1),i=tO.fixture(.5,.99,1,this.id,tq.PARTICLE,tq.ENEMY),s=tO.planckCircle(this.width/2);v.createBody(this,s,t,i)},this.setPath=t=>{this.path=t},this.damage=t=>{this.hp-=t,this.hp<=0&&(this.remove=!0);let i=new tQ(t);i.x=this.x,i.y=this.y,v.addEntity(i)},this.handleCollision=t=>{t&&!t.remove&&t.type===m.PARTICLE&&this.damage(t.damage)},this.update=t=>{t%100&&this.path.findPath(this,this.playerModel.getPosition()),this.path.update(t);let i=this.model.getSpeed(),s=u.Vec2(i.x,i.y);this.body.setLinearVelocity(s);let e=this.body.getPosition();this.x=e.x,this.y=e.y},this.dispose=()=>{v.destroyBody(this.body)},this.model=i,this.playerModel=s,this.type=m.ENEMY,this.view=!0,this.hp=50,this.i=tO.image(t),this.i.y-=this.i.height/2,this.i.x-=this.i.width/2,this.addChild(this.i)}}class t0 extends T{constructor(){super(),this.init=()=>{let t=tO.body(!0,1,1,"static"),i=tO.fixture(1,.99,1,this.id,tq.PLAYER|tq.PARTICLE|tq.ENEMY,tq.WALL),s=tO.planckBox(this.width/2,this.height/2);v.createBody(this,s,t,i)},this.handleCollision=t=>!t||t.remove?void 0:void t.type,this.addBody=t=>{this.body=t;let i=u.Vec2(this.x+this.width/2,this.y+this.width/2);this.body.setPosition(i)},this.dispose=()=>{v.destroyBody(this.body)},this.view=!0,this.layer=2,this.physics=!0,this.fixed=!0,this.type=m.WALL,this.maskBits=m.PLAYER|m.PARTICLE,m.ENEMY,this.categoryBits=m.WALL,this.i=tO.image("collision/wall.png"),this.addChild(this.i)}}class t1 extends T{constructor(t,i,s){super(),this.tilePos=()=>({x:this.tileX,y:this.tileY}),this.tileX=t,this.tileY=i,this.layer=3,this.view=!0,this.hover=tO.image("collision/hover.png"),this.addChild(this.hover),this.hover.visible=!1,this.s=tO.shape(),this.s.rectangle(32,32),this.s.onMouseDown(()=>{s(this)}),this.s.onRollOver(()=>{this.hover.visible=!0}),this.s.onRollOut(()=>{this.hover.visible=!1}),this.addChild(this.s)}}var t2=s(9657),t3=s.n(t2);class t5{constructor(t,i,s){this.findPath=(t,i)=>{let s=this.grid.clone();return this.finder.findPath(t.x,t.y,i.x,i.y,s)},this.add=(t,i,s)=>{t.x=i*this.tileSize,t.y=s*this.tileSize},this.setWalkableAt=(t,i,s)=>{this.grid.setWalkableAt(t,i,s)},this.getTilePosition=(t,i)=>({x:t*this.tileSize,y:i*this.tileSize}),this.getTileCenter=(t,i)=>({x:t*this.tileSize+this.tileSize/2,y:i*this.tileSize+this.tileSize/2}),this.getTileAt=(t,i)=>({x:Math.floor(t/this.tileSize),y:Math.floor(i/this.tileSize)}),this.tileSize=t,this.width=i,this.height=s,this.finder=new(t3()).AStarFinder({allowDiagonal:!0,dontCrossCorners:!0}),this.grid=new(t3()).Grid(this.width,this.height)}}class t7{constructor(t,i,s){this.findPath=(t,i)=>{this.target=null;let s=this.map.getTileAt(t.x,t.y),e=this.map.getTileAt(i.x,i.y);this.path=this.map.findPath(s,e),this.nextTarget()},this.nextTarget=()=>{if(0===this.path.length){this.target=null,this.control.stop();return}let t=this.path.shift();this.setTarget(t)},this.setTarget=t=>{let i={x:t[0],y:t[1]},s=this.map.getTileAt(this.entity.x,this.entity.y),e=this.control.getDirectionToPoint(s,i);this.control.setDirection(e),this.target=this.map.getTileCenter(i.x,i.y),this.control.moveToPoint(this.entity.pos(),this.target)},this.isAtTarget=()=>20>td.distance(this.entity.pos(),this.target),this.update=()=>{this.target&&this.isAtTarget(this.target)&&this.nextTarget()},this.entity=t,this.map=i,this.control=s,this.path=null,this.target=null}}class t6 extends t_{constructor(){var t;super(),t=this,this.build=()=>{for(let t=0;t<this.map.width;t+=1)this.wall(t,0);for(let t=0;t<this.map.width;t+=1)this.wall(t,this.map.height-1);for(let t=1;t<this.map.height-1;t+=1)this.wall(0,t);for(let t=1;t<this.map.height-1;t+=1)this.wall(this.map.width-1,t);for(let t=1;t<this.map.width-1;t+=1)for(let i=1;i<this.map.height-1;i+=1)10*Math.random()<2?this.wall(t,i):this.floor(t,i)},this.add=(t,i,s)=>{this.map.add(t,i,s),this.items.push(t),v.addEntity(t)},this.wall=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.add(new t0,i,s),t.map.setWalkableAt(i,s,!1)},this.floor=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=new t1(i,s,i=>{t.target=null,t.path.findPath(t.player,i)});t.add(e,i,s)},this.enemy=(t,i,s)=>{let e=new tG,h=new tU(e),n=new t$(t,e,tz);n.setPath(new t7(n,this.map,h)),this.add(n,i,s)},this.update=t=>{this.enemySpawner.update(t),this.path.update(t)},this.dispose=()=>{v.removeEntity(this.p),v.removeEntity(this.walls),this.items.forEach(t=>{v.removeEntity(t)}),this.items=[],this.control.dispose()},this.items=[],this.control=new tU(tz),this.control.keys(),this.map=new t5(32,15,10),this.player=new tJ(tz),this.path=new t7(this.player,this.map,this.control),this.add(this.player,5,5),this.c=tO.container(),this.c.fill(9674381),this.m=tO.container(5),this.menu=tO.menu(),this.m.add(this.menu),this.menu.y=16,this.menu.add(tO.textButton("reset",()=>{this.items.forEach(t=>{v.removeEntity(t)}),this.items=[],v.removeType(m.PARTICLE),this.build()})),this.enemySpawner=tO.interval(100,()=>{let t=Math.floor(Math.random()*(this.map.width-4))+2,i=Math.floor(Math.random()*(this.map.height-4))+2;this.enemy("collision/enemy".concat(Math.floor(3*Math.random())+1,".png"),t,i)}),this.build()}}class t4 extends T{constructor(t,i){super(),this.init=()=>{let t=tO.body(!0,1,1,"static"),i=tO.fixture(1,.99,1,"wall",tq.SUICA,tq.WALL);i.userData={id:"wall",type:m.WALL};let s=tO.planckBox(this.width/2,this.height/2);v.createBody(this,s,t,i)},this.handleCollision=t=>{if(!t||t.remove)return},this.addBody=t=>{this.body=t;let i=u.Vec2(this.x+this.width/2,this.y+this.height/2);this.body.setPosition(i)},this.dispose=()=>{v.destroyBody(this.body)},this.view=!0,this.layer=2,this.physics=!0,this.fixed=!0,this.type=m.WALL,this.categoryBits=m.WALL,this.s=tO.shape(0,0,0),this.s.rectangle(t,i),this.addChild(this.s)}}var t8=s(93768);class t9 extends T{constructor(t,i,s="dynamic",e=!1){super(),this.init=()=>{let t="dynamic"===this.bodyType?tq.WALL|tq.SUICA:tq.SUICA,i=tO.body(!1,5,5,this.bodyType),s=tO.fixture(0,0,0,this.id,t,tq.SUICA,!1);s.userData={id:this.id,level:this.level,type:m.SUICA};let e=tO.planckCircle(this.level/2,2);setTimeout(()=>{v.createBody(this,e,i,s)},0)},this.vel=(t,i)=>{this.velocity=u.Vec2(t*this.speed,i*this.speed)},this.addBody=t=>{this.body=t;let i=u.Vec2(this.x,this.y);this.body.setPosition(i),this.body.setLinearVelocity(this.velocity)},this.update=t=>{if(!this.body)return;let i=this.body.getPosition();this.x=i.x,this.y=i.y,(this.x<0||this.y<-50||this.x>a.width||this.y>a.height)&&(this.remove=!0)},this.dispose=()=>{this.removeBody()},this.type=m.SUICA,this.speed=20,this.damage=10,this.render=!0,this.velocity=1,this.level=t,this.bodyType=s;let h=new n.Sprite;this.addChild(h),this.s=tO.shape(0,11674146,1),this.s.circle(t/2+1,i),h.addChild(this.s);let d=new N(t.toString(),Y.F,10);d.x=-d.width/2,d.y=-d.height/2,e&&(h.alpha=0,t8.Actuate.tween(h,2,{alpha:1}))}}class it extends t_{constructor(){super(),this.onCollision=t=>{if(t.uA.type===m.SUICA&&t.uB.type===m.SUICA){let i=this.balls[t.uA.id],s=this.balls[t.uB.id];if(!i||!s||i.level!==s.level||i.remove||s.remove)return;i.remove=!0,s.remove=!0,i.removeBody(),s.removeBody();let e=i.level+1,h={x:(i.x+s.x)/2,y:(i.y+s.y)/2};this.addBall(e,h,0);return}let i=t.uA.type===m.SUICA?this.balls[t.uA.id]:this.balls[t.uB.id];if(!i||i.remove)return;let s={x:i.x,y:i.y},e=i.level;i.remove=!0,i.removeBody(),setTimeout(()=>{let t=new t9(e,16777215,"static"),i=m.SUICA+this.counter;t.id=i,t.x=s.x,t.y=s.y,v.addEntity(t),this.balls[i]=t,this.counter++},10)},this.addBall=(t,i,s)=>{let e=new t9(t,16777215,"dynamic",!0);e.id=m.SUICA+this.counter,e.x=i.x,e.y=i.y;let h=1.5*Math.PI,n=s*Math.cos(h),a=s*Math.sin(h);e.vel(n,a),v.addEntity(e),this.balls[e.id]=e,this.counter++},this.wall=(t,i,s,e)=>{let h=new t4(s,e);h.x=t,h.y=i,v.addEntity(h),this.entities.push(h)},this.clear=()=>{this.entities.forEach(t=>{t.parent.removeChild(t)}),this.entities=[],clearInterval(this.interval)},this.update=()=>{this.entities.forEach(t=>{t.update()})},this.dispose=()=>{this.clear(),v.removeEntity(this.container),v.removeEntity(this.menu)},this.entities=[],this.container=tO.container(t=>{let i={x:t.stageX/a.scale,y:t.stageY/a.scale};this.addBall(1,i,4)}),this.menu=tO.menu(),this.container.add(this.menu),this.map=new t5(32,10,10),this.counter=0,this.menu.y=a.height-this.menu.height,this.container.center(),this.balls={},this.s=tO.shape(0,11674146,1),this.s.rectangle(a.width,a.height),this.s.x=-a.width/2,this.s.y=-a.height/2,this.container.add(this.s);let t=a.width,i=a.height;this.wall(a.width/2-t/2,a.height/2+i/2,t,a.height-a.height/2+i/2),this.wall(0,0,a.width/2-t/2,a.height),this.wall(a.width/2+t/2,0,a.height,a.height-a.width/2+t/2),g.subscribe(p.COLLISION,this.onCollision),setInterval(()=>{this.addBall(1,{x:Math.random()*(t-20)+a.width/2-t/2+10,y:a.height/2-i/2-10},0)},5e3/l.fps);let s=new N("God jul");s.y=-s.height/2,s.x=-s.width/2,this.container.add(s),this.container.centerContent()}}class ii{constructor(){this.onSetStateMessage=t=>{this.sm.set(t)},this.onSetScale=()=>{this.sm.reload()},g.subscribe(p.SET_STATE,this.onSetStateMessage),g.subscribe(p.SET_SCALE,this.onSetScale),this.sm=tO.stateMachine(),this.sm.add(tP.DRAW,()=>{this.state=new tN,v.addEntity(this.state)},()=>{v.removeEntity(this.state)}),this.sm.add(tP.FIBONACCI,()=>{this.state=new tY,v.addEntity(this.state)},()=>{v.removeEntity(this.state)}),this.sm.add(tP.COLLISION,()=>{this.state=new t6,v.addEntity(this.state)},()=>{v.removeEntity(this.state)}),this.sm.add(tP.Suica,()=>{this.state=new it,v.addEntity(this.state)},()=>{v.removeEntity(this.state)})}}var is=s(55438),ie=s.n(is);class ih extends T{constructor(){super(),this.init=()=>{this.stage.addEventListener(ie().KEY_DOWN,this.onKeyDown),this.stage.addEventListener(ie().KEY_UP,this.onKeyUp)},this.onKeyDown=t=>{let{keyCode:i}=t;x.down(i),g.dispatch(p.KEY_DOWN,i)},this.onKeyUp=t=>{let{keyCode:i}=t;x.up(i),g.dispatch(p.KEY_UP,i)},this.onEnableKeys=t=>{if(this.keyTarget&&(this.keyTarget.disableKeyNavigation(),t===this.keyTarget)){this.keyTarget=null;return}this.keyTarget=t,this.keyTarget.enableKeyNavigation()},this.onDisableKeys=()=>{this.keyTarget&&(this.keyTarget.disableKeyNavigation(),this.keyTarget=null)},this.view=!0,this.keyTarget=null,g.subscribe(p.ENABLE_KEYS,this.onEnableKeys),g.subscribe(p.DISABLE_KEYS,this.onDisableKeys)}}class ia extends o(){constructor(){super(),this.view=new tA,this.overlay=new tD,this.engine=new y(this.view),this.states=new ii,this.addChild(this.view),this.addChild(this.overlay),this.engine.start(),v.addEntity(new b),v.addEntity(new ih),v.setState(tP.Suica)}}class id extends n.Sprite{init(t){a.windowWidth=window.innerWidth,a.windowHeight=window.innerHeight,a.scale=Math.min(Math.ceil(1/(100/a.windowWidth)),Math.ceil(1/(100/a.windowHeight))),a.width=a.windowWidth/a.scale,a.height=a.windowHeight/a.scale;let i=new n.AssetManifest;i.addBitmapData("assets/pause.png"),i.addBitmapData("assets/resume.png"),i.addBitmapData("assets/caret.png"),i.addBitmapData("assets/handle.png"),i.addBitmapData("assets/transparent.png"),i.addBitmapData("assets/target.png"),i.addFont("04b03","assets/font/04b03.ttf"),n.AssetLibrary.loadFromManifest(i).onComplete(i=>{n.Assets.registerLibrary("default",i);let s=new n.Stage(window.innerWidth,window.innerHeight,11674146,ia);t.appendChild(s.element)}).onError(t=>{console.error(t)})}}var io=()=>(h.useEffect(()=>{new id().init(document.getElementById("app"))},[]),(0,e.jsx)(e.Fragment,{}))}}]);